generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Cliente {
  id                    Int     @id @default(autoincrement())
  razonSocial           String  @map("razon_social")
  ruc                   String  @unique
  direccion             String?
  telefono              String?
  email                 String?
  estado                Boolean @default(true)
  codigoUnidadEjecutora String? @map("codigo_unidad_ejecutora")
  departamento          String?
  provincia             String?
  distrito              String?

  // Nuevos campos para dirección de entrega predeterminada
  direccionEntregaPredeterminada     String? @map("direccion_entrega_predeterminada")
  distritoEntregaPredeterminado      String? @map("distrito_entrega_predeterminado")
  provinciaEntregaPredeterminada     String? @map("provincia_entrega_predeterminada")
  departamentoEntregaPredeterminado  String? @map("departamento_entrega_predeterminado")
  
  // Mesa de partes del cliente
  usuarioMesaPartes                  String? @map("usuario_mesa_partes")
  contrasenaMesaPartes               String? @map("contrasena_mesa_partes")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  contactos            Contacto[]
  cuentasBancarias     CuentaBancaria[]
  cotizaciones         Cotizacion[]
  ordenesCompra        OrdenCompra[]
  ordenesCompraPrivada OrdenCompraPrivada[] // Relación inversa añadida

  @@map("clientes")
}

model Proveedor {
  id           Int     @id @default(autoincrement())
  razonSocial  String  @map("razon_social")
  ruc          String  @unique
  direccion    String?
  telefono     String?
  email        String?
  estado       Boolean @default(true)
  departamento String?
  provincia    String?
  distrito     String?

  // Gestión de pagos predeterminada
  formaPagoPredeterminada           String?  @map("forma_pago_predeterminada")
  porcentajePagoPredeterminado      Decimal? @map("porcentaje_pago_predeterminado")
  estadoPagoPredeterminado          EstadoPagoOpProveedor? @map("estado_pago_predeterminado")
  
  // Cotización y estado
  capturaCotizacionUrl              String?  @map("captura_cotizacion_url")
  estadoProveedorOp                 EstadoPagoOpProveedor? @map("estado_proveedor_op")
  
  // Mesa de partes
  usuarioMesaPartes                 String?  @map("usuario_mesa_partes_proveedor")
  contrasenaMesaPartes              String?  @map("contrasena_mesa_partes_proveedor")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  contactos        Contacto[]
  ordenesProveedor OrdenProveedor[]
  saldosProveedor  SaldoProveedor[]
  cuentasBancarias CuentaBancaria[]

  @@map("proveedores")
}

model SaldoProveedor {
  id             Int                 @id @default(autoincrement())
  proveedorId    Int
  tipoMovimiento MovimientoProveedor @default(A_FAVOR) // Puede ser "A FAVOR" o "DEBE"
  monto          Decimal
  descripcion    String?
  fecha          DateTime            @default(now())
  activo         Boolean             @default(true)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  proveedor Proveedor @relation(fields: [proveedorId], references: [id])

  @@map("saldos_proveedor")
}

model CuentaBancaria {
  id           Int                @id @default(autoincrement())
  referenciaId Int                @map("referencia_id")
  tipoCuenta   CuentaBancariaTipo @map("tipo_cuenta")
  banco        String
  numeroCuenta String
  numeroCci    String?
  moneda       Moneda
  activa       Boolean            @default(true)

  clienteId    Int? @map("cliente_id")
  proveedorId  Int? @map("proveedor_id")
  transporteId Int? @map("transporte_id")
  empresaId    Int? @map("empresa_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  cliente    Cliente?    @relation(fields: [clienteId], references: [id])
  proveedor  Proveedor?  @relation(fields: [proveedorId], references: [id])
  transporte Transporte? @relation(fields: [transporteId], references: [id])
  empresa    Empresa?    @relation(fields: [empresaId], references: [id])

  @@map("cuentas_bancarias")
}

model Transporte {
  id           Int     @id @default(autoincrement())
  razonSocial  String  @map("razon_social")
  ruc          String  @unique
  cobertura    String?
  departamento String?
  provincia    String?
  distrito     String?
  direccion    String?
  telefono     String?
  email        String?
  estado       Boolean @default(true)

  // Mesa de partes
  usuarioMesaPartes                 String? @map("usuario_mesa_partes_transporte")
  contrasenaMesaPartes              String? @map("contrasena_mesa_partes_transporte")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  cuentasBancarias     CuentaBancaria[]
  contactos            Contacto[]
  transportesAsignados TransporteAsignado[]

  @@map("transportes")
}

model Empresa {
  id           Int     @id @default(autoincrement())
  razonSocial  String  @map("razon_social")
  ruc          String  @unique
  direccion    String?
  telefono     String?
  email        String?
  departamento String?
  provincia    String?
  distrito     String?
  logo         String?
  direcciones  String?
  web          String?

  // Mesa de partes
  usuarioMesaPartes                 String? @map("usuario_mesa_partes_empresa")
  contrasenaMesaPartes              String? @map("contrasena_mesa_partes_empresa")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  catalogos        Catalogo[]
  cotizaciones     Cotizacion[]
  ordenesCompra    OrdenCompra[]
  ordenesProveedor OrdenProveedor[]
  cuentasBancarias CuentaBancaria[]

  @@map("empresas")
}

model Contacto {
  id               Int          @id @default(autoincrement())
  nombre           String
  apellido         String?
  telefono         String?
  email            String?
  cargo            String?
  cumpleanos       DateTime?
  nota             String?
  usuarioDestacado Boolean?     @map("usuario_destacado")
  tipo             ContactoTipo
  referenciaId     Int          @map("referencia_id")
  clienteId        Int?         @map("cliente_id")
  proveedorId      Int?         @map("proveedor_id")
  transporteId     Int?         @map("transporte_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  cliente              Cliente?             @relation(fields: [clienteId], references: [id])
  proveedor            Proveedor?           @relation(fields: [proveedorId], references: [id])
  transporte           Transporte?          @relation(fields: [transporteId], references: [id])
  Cotizacion           Cotizacion[]
  ordenesProveedor     OrdenProveedor[]
  transportesAsignados TransporteAsignado[]
  ordenesCompra        OrdenCompra[] // Relación inversa para contactoClienteId
  ordenesCompraPrivada OrdenCompraPrivada[] // Relación inversa añadida

  @@map("contactos")
}

model Catalogo {
  id          Int     @id @default(autoincrement())
  nombre      String
  descripcion String?
  empresaId   Int     @map("empresa_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  empresa       Empresa       @relation(fields: [empresaId], references: [id])
  ordenesCompra OrdenCompra[] // Relación inversa añadida

  @@map("catalogos")
}

model Cotizacion {
  id                Int    @id @default(autoincrement())
  codigoCotizacion  String @unique @map("codigo_cotizacion")
  empresaId         Int    @map("empresa_id")
  clienteId         Int    @map("cliente_id")
  contactoClienteId Int?   @map("contacto_cliente_id")

  montoTotal Decimal  @map("monto_total")
  tipoPago   TipoPago @map("tipo_pago")
  notaPago   String?  @map("nota_pago")
  notaPedido String?  @map("nota_pedido")

  direccionEntrega    String? @map("direccion_entrega")
  distritoEntrega     String? @map("distrito_entrega")
  provinciaEntrega    String? @map("provincia_entrega")
  departamentoEntrega String? @map("departamento_entrega")
  referenciaEntrega   String? @map("referencia_entrega")

  estado          CotizacionEstado @default(PENDIENTE)
  fechaCotizacion DateTime         @map("fecha_cotizacion")
  fechaEntrega    DateTime?        @map("fecha_entrega")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  cliente         Cliente   @relation(fields: [clienteId], references: [id])
  empresa         Empresa   @relation(fields: [empresaId], references: [id])
  contactoCliente Contacto? @relation(fields: [contactoClienteId], references: [id])

  productos CotizacionProducto[]

  @@map("cotizaciones")
}

model CotizacionProducto {
  id              Int     @id @default(autoincrement())
  codigo          String
  descripcion     String
  unidadMedida    String? @map("unidad_medida")
  cantidad        Int
  cantidadAlmacen Int?    @map("cantidad_almacen")
  cantidadTotal   Int     @map("cantidad_total")
  precioUnitario  Decimal @map("precio_unitario")
  total           Decimal

  cotizacionId Int @map("cotizacion_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  cotizacion Cotizacion @relation(fields: [cotizacionId], references: [id])

  @@map("cotizacion_productos")
}

model OrdenCompra {
  id           Int       @id @default(autoincrement())
  codigoVenta  String    @unique @map("codigo_venta")
  fechaEmision DateTime? @map("fecha_emision") @db.Date
  archivoOc    String?   @map("archivo_oc")

  // Relaciones principales
  empresaId         Int? @map("empresa_id")
  clienteId         Int? @map("cliente_id")
  contactoClienteId Int? @map("contacto_cliente_id")
  catalogoEmpresaId Int? @map("catalogo_empresa_id")

  // Ventas
  ventaPrivada        Boolean   @default(false) @map("venta_privada")
  provinciaEntrega    String?   @map("provincia_entrega")
  distritoEntrega     String?   @map("distrito_entrega")
  departamentoEntrega String?   @map("departamento_entrega")
  direccionEntrega    String?   @map("direccion_entrega")
  referenciaEntrega   String?   @map("referencia_entrega")
  fechaEntrega        DateTime? @map("fecha_entrega") @db.Date
  montoVenta          Decimal?  @map("monto_venta") @db.Decimal(10, 2)
  fechaForm           DateTime? @map("fecha_form") @db.Date
  fechaMaxForm        DateTime? @map("fecha_max_form") @db.Date
  productos           Json? // Mapeado desde $table->json('productos')
  documentoOce        String?   @map("documento_oce")
  documentoOcf        String?   @map("documento_ocf")
  siaf                String?
  etapaSiaf           String?   @map("etapa_siaf")
  fechaSiaf           DateTime? @map("fecha_siaf") @db.Date

  // Seguimiento
  documentoPeruCompras String?   @map("documento_peru_compras")
  fechaPeruCompras     DateTime? @map("fecha_peru_compras") @db.Date
  fechaEntregaOc       DateTime? @map("fecha_entrega_oc") @db.Date // Campo duplicado? Revisar si es necesario
  // Cobranzas
  penalidad           Decimal?  @db.Decimal(10, 2)
  netoCobrado         Decimal?  @map("neto_cobrado") @db.Decimal(10, 2)
  estadoCobranza      String?   @map("estado_cobranza")
  fechaEstadoCobranza DateTime? @map("fecha_estado_cobranza") @db.Date
  fechaProximaGestion DateTime? @map("fecha_proxima_gestion") @db.Date

  // Documentación y seguimiento
  documentoExtensionPlazoUrl        String?  @map("documento_extension_plazo_url")
  estadoDocumentacionOc             EstadoDocumentacionOc? @map("estado_documentacion_oc")
  notaAdicionalDocumentacionOc      String?  @map("nota_adicional_documentacion_oc")
  
  // Información del cliente
  codigoUnidadEjecutoraCliente      String?  @map("codigo_unidad_ejecutora_cliente")
  
  // Estados y flags
  entregaParcial                    Boolean? @default(false) @map("entrega_parcial")
  tuvoAmpliacionEntrega             Boolean? @default(false) @map("tuvo_ampliacion_entrega")
  fueCobrada                        Boolean? @default(false) @map("fue_cobrada")
  ventaAnulada                      Boolean? @default(false) @map("venta_anulada")
  motivoAnulacionVenta              String?  @map("motivo_anulacion_venta")
  
  // Mesa de partes
  numeroEnvioMesaPartes             String?  @map("numero_envio_mesa_partes")
  pdfEnvioMesaPartesUrl             String?  @map("pdf_envio_mesa_partes_url")

  etapaActual  String  @default("creacion") @map("etapa_actual")
  estadoActivo Boolean @default(true) @map("estado_activo")

  // Campos de auditoría (ya existentes)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  // Relaciones (actualizadas/añadidas)
  empresa            Empresa?            @relation(fields: [empresaId], references: [id])
  cliente            Cliente?            @relation(fields: [clienteId], references: [id])
  contactoCliente    Contacto?           @relation(fields: [contactoClienteId], references: [id])
  catalogoEmpresa    Catalogo?           @relation(fields: [catalogoEmpresaId], references: [id])
  ordenesProveedor   OrdenProveedor[]
  ordenCompraPrivada OrdenCompraPrivada?
  facturaciones      Facturacion[]
  gestionCobranzas   GestionCobranza[]
  programacionesEntrega ProgramacionEntrega[]

  // Relaciones con modelos aún no definidos (añadir estos modelos después)
  // pagosTesoreria       PagoTesoreria[]
  OrdenCompraAgrupada OrdenCompraAgrupada[]

  @@map("ordenes_compra")
}

// filepath: c:\Users\HAROLD\Documents\TECSUP\Tesis\template-express\prisma\schema.prisma
// ...existing code...
model AgrupacionOrdenCompra {
  id          Int      @id @default(autoincrement())
  codigoGrupo String   @map("codigo_grupo") @db.VarChar(255) // Añadido @map
  descripcion String?
  fecha       DateTime @default(now())

  createdAt DateTime @default(now()) @map("created_at") // Auditoría añadida
  updatedAt DateTime @updatedAt @map("updated_at") // Auditoría añadida

  ordenesCompra OrdenCompraAgrupada[]

  @@map("agrupaciones_orden_compra") // Mapeo añadido
}

model OrdenCompraAgrupada {
  id                      Int @id @default(autoincrement())
  agrupacionOrdenCompraId Int @map("agrupacion_orden_compra_id") // Añadido @map
  ordenCompraId           Int @map("orden_compra_id") // Añadido @map

  createdAt DateTime @default(now()) @map("created_at") // Auditoría añadida
  updatedAt DateTime @updatedAt @map("updated_at") // Auditoría añadida

  agrupacion  AgrupacionOrdenCompra @relation(fields: [agrupacionOrdenCompraId], references: [id])
  ordenCompra OrdenCompra           @relation(fields: [ordenCompraId], references: [id])

  @@map("ordenes_compra_agrupadas")
}

model OrdenCompraPrivada {
  id                Int       @id @default(autoincrement())
  ordenCompraId     Int       @unique @map("orden_compra_id") // Clave foránea y única para relación 1-1
  clienteId         Int?      @map("cliente_id")
  contactoClienteId Int?      @map("contacto_cliente_id")
  estadoPago        String?   @map("estado_pago")
  fechaPago         DateTime? @map("fecha_pago") @db.Date
  documentoPago     String?   @map("documento_pago")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relaciones
  ordenCompra     OrdenCompra              @relation(fields: [ordenCompraId], references: [id])
  cliente         Cliente?                 @relation(fields: [clienteId], references: [id])
  contactoCliente Contacto?                @relation(fields: [contactoClienteId], references: [id])
  pagos           PagoOrdenCompraPrivada[] // Relación inversa

  @@map("ordenes_compra_privadas")
}

model PagoOrdenCompraPrivada {
  id                   Int       @id @default(autoincrement())
  ordenCompraPrivadaId Int       @map("orden_compra_privada_id")
  fechaPago            DateTime? @map("fecha_pago") @db.Date
  bancoPago            String?   @map("banco_pago")
  descripcionPago      String?   @map("descripcion_pago") @db.Text // Asumiendo que puede ser largo
  archivoPago          String?   @map("archivo_pago")
  montoPago            Decimal?  @map("monto_pago") @db.Decimal(10, 2)
  estadoPago           Boolean   @default(false) @map("estado_pago")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relación
  ordenCompraPrivada OrdenCompraPrivada @relation(fields: [ordenCompraPrivadaId], references: [id])

  @@map("pagos_ordenes_compra_privadas")
}

model OrdenProveedor {
  id                  Int    @id @default(autoincrement())
  codigoOp            String @map("codigo_op") @db.VarChar(255)
  empresaId           Int?   @map("empresa_id")
  proveedorId         Int?   @map("proveedor_id")
  contactoProveedorId Int?   @map("contacto_proveedor_id")

  fechaDespacho   DateTime? @map("fecha_despacho")
  fechaProgramada DateTime? @map("fecha_programada")
  fechaRecepcion  DateTime? @map("fecha_recepcion")

  notaPedido     String?  @map("nota_pedido")
  totalProveedor Decimal? @map("total_proveedor")
  tipoPago       String?  @map("tipo_pago")
  notaPago       String?  @map("nota_pago")

  notaGestionOp  String?  @map("nota_gestion_op")
  tipoEntrega       String? @map("tipo_entrega")
  retornoMercaderia String? @map("retorno_mercaderia")
  estadoOp          String? @map("estado_op")
  fechaEntrega      String? @map("fecha_entrega")
  cargoOea          String? @map("cargo_oea")
  etiquetado    String?
  embalaje      String?
  observaciones String?
  notaAdicional String? @map("nota_adicional")

  // Estado y anulación
  ventaAnulada                      Boolean?  @default(false) @map("venta_anulada_op")
  motivoAnulacion                   String?   @map("motivo_anulacion_op")
  
  // Documentación
  documentoEntregaCompletoUrl       String?   @map("documento_entrega_completo_url")
  etiquetadoCompletoVisualizacionUrl String?  @map("etiquetado_completo_visualizacion_url")
  
  // Estado de completado
  opCompletadoSeguimiento           Boolean?  @default(false) @map("op_completado_seguimiento")

  activo        Boolean @default(true)
  ordenCompraId Int?    @map("orden_compra_id")

  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime? @updatedAt @map("updated_at") @db.Timestamp(6)
  empresa           Empresa?     @relation(fields: [empresaId], references: [id])
  proveedor         Proveedor?   @relation(fields: [proveedorId], references: [id])
  contactoProveedor Contacto?    @relation(fields: [contactoProveedorId], references: [id])
  ordenCompra       OrdenCompra? @relation(fields: [ordenCompraId], references: [id])

  productos                 OpProducto[]
  pagos                     PagoOrdenProveedor[]
  transportesAsignados      TransporteAsignado[]
  historialModificaciones   HistorialModificacionesOp[]
  programacionesEntrega     ProgramacionEntrega[]

  @@map("ordenes_proveedor")
}

model OpProducto {
  id              Int     @id @default(autoincrement())
  codigo          String
  descripcion     String
  unidadMedida    String? @map("unidad_medida")
  cantidad        Int
  cantidadAlmacen Int?    @map("cantidad_almacen")
  cantidadTotal   Int     @map("cantidad_total")
  precioUnitario  Decimal @map("precio_unitario")
  total           Decimal

  ordenProveedorId Int @map("orden_proveedor_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  ordenProveedor OrdenProveedor @relation(fields: [ordenProveedorId], references: [id])

  @@map("productos_orden_proveedor")
}

model TransporteAsignado {
  id                   Int         @id @default(autoincrement())
  codigoTransporte     String      @map("codigo_transporte")
  transporteId         Int         @map("transporte_id")
  ordenProveedorId     Int         @map("orden_proveedor_id")
  contactoTransporteId Int?        @map("contacto_transporte_id")
  tipoDestino          TipoDestino @map("tipo_destino")
  region               String?
  provincia            String?
  distrito             String?
  direccion            String?
  notaTransporte       String?     @map("nota_transporte")
  cotizacionTransporte String?     @map("cotizacion_transporte")
  estadoPago           String?     @map("estado_pago")
  montoFlete           Decimal?    @map("monto_flete") @db.Decimal(10, 2)
  grt                  String?

  // Estado del flete
  estadoFlete                       EstadoFlete? @map("estado_flete")
  
  // Cotización y documentación
  documentoCotizacionFleteUrl       String?   @map("documento_cotizacion_flete_url")
  montoCotizacionFlete              Decimal?  @map("monto_cotizacion_flete")
  fleteCotizadoFotoUrl              String?   @map("flete_cotizado_foto_url")
  
  // Pago del transporte
  fechaPagoTransporte               DateTime? @map("fecha_pago_transporte")
  pagoCompletadoTransporte          Boolean?  @default(false) @map("pago_completado_transporte")
  
  // Guías y facturas
  guiaTransporteNumero              String?   @map("guia_transporte_numero")
  guiaTransporteUrl                 String?   @map("guia_transporte_url")
  facturaTransporteNumero           String?   @map("factura_transporte_numero")
  facturaTransporteUrl              String?   @map("factura_transporte_url")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  transporte         Transporte     @relation(fields: [transporteId], references: [id])
  ordenProveedor     OrdenProveedor @relation(fields: [ordenProveedorId], references: [id])
  contactoTransporte Contacto?      @relation(fields: [contactoTransporteId], references: [id])

  pagos PagoTransporteAsignado[]

  @@map("transportes_asignados")
}

enum TipoDestino {
  ALMACEN
  CLIENTE
}

model PagoTransporteAsignado {
  id                   Int       @id @default(autoincrement())
  transporteAsignadoId Int       @map("transporte_asignado_id")
  fechaPago            DateTime? @map("fecha_pago") @db.Date
  bancoPago            String?   @map("banco_pago")
  descripcionPago      String?   @map("descripcion_pago")
  archivoPago          String?   @map("archivo_pago")
  montoPago            Decimal?  @map("monto_pago") @db.Decimal(10, 2)
  estadoPago           Boolean?  @default(false) @map("estado_pago")
  activo               Boolean?  @default(true)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  transporteAsignado TransporteAsignado @relation(fields: [transporteAsignadoId], references: [id])

  @@map("pagos_transportes_asignados")
}

model PagoOrdenProveedor {
  id               Int       @id @default(autoincrement())
  fechaPago        DateTime? @map("fecha_pago")
  bancoPago        String?   @map("banco_pago") @db.VarChar(255)
  descripcionPago  String?   @map("descripcion_pago")
  archivoPago      String?   @map("archivo_pago") @db.VarChar(255)
  montoPago        Decimal?  @map("monto_pago") @db.Decimal(10, 4)
  estadoPago       Boolean   @default(false) @map("estado_pago")
  activo           Boolean   @default(true)
  ordenProveedorId Int?      @map("orden_proveedor_id")

  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime? @updatedAt @map("updated_at") @db.Timestamp(6)

  ordenProveedor OrdenProveedor? @relation(fields: [ordenProveedorId], references: [id])

  @@map("pagos_orden_proveedor")
}

model Producto {
  id           Int      @id @default(autoincrement())
  nombre       String
  descripcion  String?
  unidadMedida String?  @map("unidad_medida")
  precioBase   Decimal? @map("precio_base") @db.Decimal(10, 4)
  estado       Boolean? @default(true)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at")

  stockProductos StockProducto[]

  @@map("productos")
}

model StockProducto {
  id         Int @id @default(autoincrement())
  productoId Int @map("producto_id")
  almacenId  Int @map("almacen_id")
  cantidad   Int @default(0)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  producto Producto @relation(fields: [productoId], references: [id])
  almacen  Almacen  @relation(fields: [almacenId], references: [id])

  @@unique([productoId, almacenId])
  @@map("stock_productos")
}

model Almacen {
  id        Int     @id @default(autoincrement())
  nombre    String
  direccion String?
  ciudad    String?

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at")

  stockProductos StockProducto[]

  @@map("almacenes")
}

// Nuevo modelo Facturacion
model Facturacion {
  id                Int       @id @default(autoincrement())
  ordenCompraId     Int       @map("orden_compra_id")
  factura           String?
  fechaFactura      DateTime? @map("fecha_factura") @db.Date
  grr               String?
  retencion         Decimal?  @db.Decimal(10, 2)
  detraccion        Decimal?  @db.Decimal(10, 2)
  formaEnvioFactura String?   @map("forma_envio_factura")
  estado            Int?      @default(1)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relación
  ordenCompra OrdenCompra @relation(fields: [ordenCompraId], references: [id])

  @@map("facturaciones")
}

// Nuevo modelo GestionCobranza
model GestionCobranza {
  id            Int       @id @default(autoincrement())
  ordenCompraId Int       @map("orden_compra_id")
  historial     String?   @db.Text // Asumiendo que puede ser largo
  descripcion   String?   @db.Text // Asumiendo que puede ser largo
  fechaGestion  DateTime? @map("fecha_gestion") @db.Date
  documentoUrl  String?   @map("documento_url")
  estado        Int?      @default(1)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relación
  ordenCompra OrdenCompra @relation(fields: [ordenCompraId], references: [id])

  @@map("gestion_cobranzas")
}

model Usuario {
  id       Int     @id @default(autoincrement())  nombre   String
  email    String  @unique
  password String
  role     Role    @default(USER)
  foto     String?
  estado   Boolean @default(true)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  historialModificaciones     HistorialModificacionesOp[]
  programacionesResponsable   ProgramacionEntrega[] @relation("ResponsableProgramacion")

  @@map("usuarios")
}

enum ContactoTipo {
  CLIENTE
  PROVEEDOR
  TRANSPORTE
}

enum CotizacionEstado {
  PENDIENTE
  ACEPTADA
  RECHAZADA
}

enum OrdenCompraEstado {
  PENDIENTE
  FACTURADA
  CANCELADA
}

enum OrdenProveedorEstado {
  PENDIENTE
  RECIBIDA
  ANULADA
}

enum Role {
  ADMIN
  USER
}

enum TipoPago {
  CONTADO
  CREDITO
  ANTICIPADO
  OTROS
}

enum MovimientoProveedor {
  A_FAVOR
  DEBE
}

enum TipoCuenta {
  AHORROS
  CORRIENTE
}

enum Moneda {
  SOLES
  DOLARES
}

enum CuentaBancariaTipo {
  CLIENTE
  PROVEEDOR
  TRANSPORTE
  EMPRESA
}

// Estados de programación
enum EstadoProgramacionOp {
  PENDIENTE
  COMPLETADO
  CANCELADO
  PROCESANDO
}

// Tipos de programación
enum TipoProgramacionOp {
  PROGRAMADO
  REPROGRAMADO
  PROGRAMADO_ENTREGADO
  REPROGRAMADO_ENTREGADO
}

// Estados de flete
enum EstadoFlete {
  PAGO_URGENTE
  PAGAR
  COTIZANDO
}

// Estados de pago OP Proveedor
enum EstadoPagoOpProveedor {
  URGENTE_PAGO
  PENDIENTE_PAGO
  PAGAR_PROVEEDOR
  COTIZANDO_PAGO
  PAGADO_PARCIAL
  PAGADO_TOTAL
}

// Estados de OP Seguimiento
enum EstadoOpSeguimiento {
  PENDIENTE
  EN_PROCESO
  COMPLETADO
  RETRASADO
  CANCELADO
}

// Estados de documentación OC
enum EstadoDocumentacionOc {
  CON_GUIA
  CON_FACTURA
  SIN_DOCUMENTO
}

// Tipos de cobranza
enum TipoCobranza {
  ESPECIAL
  NORMAL
}

model HistorialModificacionesOp {
  id                Int      @id @default(autoincrement())
  ordenProveedorId  Int      @map("orden_proveedor_id")
  usuarioId         Int      @map("usuario_id")
  campoModificado   String   @map("campo_modificado")
  valorAnterior     String?  @map("valor_anterior")
  valorNuevo        String?  @map("valor_nuevo")
  fechaModificacion DateTime @default(now()) @map("fecha_modificacion")
  motivo            String?
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  ordenProveedor OrdenProveedor @relation(fields: [ordenProveedorId], references: [id])
  usuario        Usuario        @relation(fields: [usuarioId], references: [id])
  
  @@map("historial_modificaciones_op")
}

model ProgramacionEntrega {
  id                      Int                  @id @default(autoincrement())
  ordenProveedorId        Int?                 @map("orden_proveedor_id")
  ordenCompraId           Int?                 @map("orden_compra_id")
  tipoProgramacion        TipoProgramacionOp   @map("tipo_programacion")
  estadoProgramacion      EstadoProgramacionOp @map("estado_programacion")
  responsableEntregaId    Int?                 @map("responsable_entrega_id")
  fechaMaximaEntrega      DateTime?            @map("fecha_maxima_entrega")
  monto                   Decimal?
  ordenElectronica        String?              @map("orden_electronica_prog")
  ordenFisica             String?              @map("orden_fisica_prog")
  departamentoEntrega     String?              @map("departamento_entrega_prog")
  provinciaEntrega        String?              @map("provincia_entrega_prog")
  distritoEntrega         String?              @map("distrito_entrega_prog")
  documentosAdjuntos      String[]             @map("documentos_adjuntos_prog")
  nota                    String?              @map("nota_prog")
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  ordenProveedor     OrdenProveedor? @relation(fields: [ordenProveedorId], references: [id])
  ordenCompra        OrdenCompra?    @relation(fields: [ordenCompraId], references: [id])
  responsableEntrega Usuario?        @relation("ResponsableProgramacion", fields: [responsableEntregaId], references: [id])
  
  @@map("programaciones_entrega")
}
