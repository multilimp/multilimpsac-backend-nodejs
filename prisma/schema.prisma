// =================================================================
// PRISMA SCHEMA - Sistema de Gesti√≥n de Distribuci√≥n MULTILIMP
// =================================================================
//
// üì¶ MODELO DE NEGOCIO:
// Este sistema gestiona las operaciones de una empresa DISTRIBUIDORA
// que vende productos al por mayor, principalmente al sector p√∫blico
// (licitaciones del Estado peruano) y tambi√©n a clientes privados.
//
// üè¢ ESTRUCTURA EMPRESARIAL:
// La empresa opera con M√öLTIPLES RAZONES SOCIALES (tabla Empresa),
// permitiendo facturar desde diferentes entidades legales seg√∫n
// el cliente o tipo de venta.
//
// üìã FLUJO PRINCIPAL DE VENTAS:
// 1. COTIZACI√ìN ‚Üí Se genera cotizaci√≥n al cliente
// 2. ORDEN DE COMPRA (OC) ‚Üí El cliente aprueba y genera la venta
//    ‚ö†Ô∏è IMPORTANTE: En este sistema, "Orden de Compra" = VENTA
//    (el cliente emite OC hacia nosotros, es decir, nos compra)
// 3. ORDEN DE PROVEEDOR (OP) ‚Üí Se genera pedido a nuestros proveedores
// 4. TRANSPORTE ‚Üí Se asigna transporte para entrega
// 5. FACTURACI√ìN ‚Üí Se emite factura al cliente
// 6. COBRANZA ‚Üí Se gestiona el cobro de la factura
//
// üèõÔ∏è VENTAS AL ESTADO (PER√ö COMPRAS / SEACE):
// - Integraci√≥n con plataformas de compras p√∫blicas
// - Seguimiento de SIAF para pagos gubernamentales
// - Gesti√≥n de documentos OCE (Orden de Compra Electr√≥nica)
// - Manejo de penalidades y conformidades
//
// üè™ VENTAS PRIVADAS:
// - Clientes particulares o empresas privadas
// - Flujo simplificado de facturaci√≥n y cobranza
// - Diferentes formas de entrega (domicilio, agencia, almac√©n)
//
// üí∞ GESTI√ìN FINANCIERA:
// - Control de pagos a proveedores
// - Gesti√≥n de saldos (a favor/debe) por proveedor
// - Seguimiento de cobranzas
// - M√∫ltiples cuentas bancarias por entidad
//
// üöö LOG√çSTICA:
// - Gesti√≥n de m√∫ltiples transportistas
// - Programaci√≥n de entregas
// - Control de almacenes y stock
//
// =================================================================

generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
}

datasource db {
  provider = "postgresql"
}

// =================================================================
// üë• ENTIDADES DE NEGOCIO (Clientes, Proveedores, Transportes)
// =================================================================

/// Modelo de Cliente - Entidades del Estado o empresas privadas que NOS COMPRAN productos.
/// En ventas al Estado: son unidades ejecutoras con c√≥digo SIAF.
/// En ventas privadas: son empresas o personas naturales.
model Cliente {
  /// Identificador √∫nico del cliente
  id                    Int              @id @default(autoincrement())
  /// Raz√≥n social o nombre de la empresa
  razonSocial           String           @map("razon_social")
  /// RUC del cliente
  ruc                   String
  /// Direcci√≥n fiscal
  direccion             String?
  /// Tel√©fono de contacto
  telefono              String?
  /// Correo electr√≥nico
  email                 String?
  /// Estado activo/inactivo del cliente
  estado                Boolean          @default(true)
  /// C√≥digo de unidad ejecutora (para entidades del Estado)
  codigoUnidadEjecutora String?          @map("codigo_unidad_ejecutora")
  /// Departamento de ubicaci√≥n
  departamento          String?
  /// Provincia de ubicaci√≥n
  provincia             String?
  /// Distrito de ubicaci√≥n
  distrito              String?
  /// Fecha de creaci√≥n del registro
  createdAt             DateTime         @default(now()) @map("created_at")
  /// Fecha de √∫ltima actualizaci√≥n
  updatedAt             DateTime         @updatedAt @map("updated_at")
  /// Sede del cliente
  sede                  String?
  /// Promedio de d√≠as de cobranza
  promedioCobranza      Decimal?         @map("promedio_cobranza") @db.Decimal(10, 2)
  /// Contactos asociados al cliente
  contactos             Contacto[]
  /// Cotizaciones realizadas al cliente
  cotizaciones          Cotizacion[]
  /// Cuentas bancarias del cliente
  cuentasBancarias      CuentaBancaria[]
  /// √ìrdenes de compra del cliente
  ordenesCompra         OrdenCompra[]

  @@map("clientes")
}

/// Modelo de Proveedor - Empresas que NOS SUMINISTRAN productos para revender.
/// Los proveedores reciben √ìrdenes de Proveedor (OP) cuando tenemos una venta confirmada.
model Proveedor {
  /// Identificador √∫nico del proveedor
  id               Int              @id @default(autoincrement())
  /// Raz√≥n social del proveedor
  razonSocial      String           @map("razon_social")
  /// RUC del proveedor
  ruc              String
  /// Direcci√≥n del proveedor
  direccion        String?
  /// Tel√©fono de contacto
  telefono         String?
  /// Correo electr√≥nico
  email            String?
  /// Estado activo/inactivo
  estado           Boolean          @default(true)
  /// Departamento de ubicaci√≥n
  departamento     String?
  /// Provincia de ubicaci√≥n
  provincia        String?
  /// Distrito de ubicaci√≥n
  distrito         String?
  /// Fecha de creaci√≥n
  createdAt        DateTime         @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt        DateTime         @updatedAt @map("updated_at")
  /// Contactos del proveedor
  contactos        Contacto[]
  /// Cuentas bancarias del proveedor
  cuentasBancarias CuentaBancaria[]
  /// √ìrdenes de proveedor asociadas
  ordenesProveedor OrdenProveedor[]
  /// Saldos a favor o deudas con el proveedor
  saldosProveedor  SaldoProveedor[]

  @@map("proveedores")
}

// =================================================================
// üí∞ GESTI√ìN FINANCIERA (Saldos y Cuentas Bancarias)
// =================================================================

/// Modelo de Saldo de Proveedor - Control de saldos a favor o deudas con proveedores.
/// Cuando pagamos de m√°s a un proveedor = A_FAVOR (nos debe mercader√≠a o devoluci√≥n).
/// Cuando debemos a un proveedor = DEBE (pendiente de pago).
model SaldoProveedor {
  /// Identificador √∫nico
  id             Int                 @id @default(autoincrement())
  /// ID del proveedor relacionado
  proveedorId    Int
  /// Tipo de movimiento: A_FAVOR o DEBE
  tipoMovimiento MovimientoProveedor @default(A_FAVOR)
  /// Monto del saldo
  monto          Decimal
  /// Descripci√≥n del movimiento
  descripcion    String?
  /// Fecha del movimiento
  fecha          DateTime            @default(now())
  /// Estado activo del saldo
  activo         Boolean             @default(true)
  /// Fecha de creaci√≥n
  createdAt      DateTime            @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt      DateTime            @updatedAt @map("updated_at")
  /// Banco relacionado al movimiento
  banco          String?
  /// Relaci√≥n con proveedor
  proveedor      Proveedor           @relation(fields: [proveedorId], references: [id])

  @@map("saldos_proveedor")
}

/// Modelo de Saldo de Transporte - Control de saldos a favor o deudas con transportistas.
/// Similar a SaldoProveedor pero para empresas de transporte.
model SaldoTransporte {
  /// Identificador √∫nico
  id             Int                  @id @default(autoincrement())
  /// ID del transporte relacionado
  transporteId   Int
  /// Tipo de movimiento: A_FAVOR o DEBE
  tipoMovimiento MovimientoTransporte @default(A_FAVOR)
  /// Monto del saldo
  monto          Decimal
  /// Descripci√≥n del movimiento
  descripcion    String?
  /// Fecha del movimiento
  fecha          DateTime             @default(now())
  /// Estado activo del saldo
  activo         Boolean              @default(true)
  /// Fecha de creaci√≥n
  createdAt      DateTime             @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt      DateTime             @updatedAt @map("updated_at")
  /// Banco relacionado al movimiento
  banco          String?
  /// Relaci√≥n con transporte
  transporte     Transporte           @relation(fields: [transporteId], references: [id])

  @@map("saldos_transporte")
}

/// Modelo de Cuenta Bancaria - Cuentas bancarias de clientes, proveedores, transportes y empresas.
/// Permite gestionar m√∫ltiples cuentas por entidad para pagos y cobros.
model CuentaBancaria {
  /// Identificador √∫nico
  id           Int                @id @default(autoincrement())
  /// ID de referencia del propietario
  referenciaId Int                @map("referencia_id")
  /// Tipo de cuenta (CLIENTE, PROVEEDOR, TRANSPORTE, EMPRESA)
  tipoCuenta   CuentaBancariaTipo @map("tipo_cuenta")
  /// Nombre del banco
  banco        String
  /// N√∫mero de cuenta
  numeroCuenta String
  /// C√≥digo de cuenta interbancaria (CCI)
  numeroCci    String?
  /// Moneda de la cuenta
  moneda       Moneda
  /// Estado activo de la cuenta
  activa       Boolean            @default(true)
  /// ID del cliente propietario (opcional)
  clienteId    Int?               @map("cliente_id")
  /// ID del proveedor propietario (opcional)
  proveedorId  Int?               @map("proveedor_id")
  /// ID del transporte propietario (opcional)
  transporteId Int?               @map("transporte_id")
  /// ID de la empresa propietaria (opcional)
  empresaId    Int?               @map("empresa_id")
  /// Fecha de creaci√≥n
  createdAt    DateTime           @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt    DateTime           @updatedAt @map("updated_at")
  /// Relaci√≥n con cliente
  cliente      Cliente?           @relation(fields: [clienteId], references: [id])
  /// Relaci√≥n con empresa
  empresa      Empresa?           @relation(fields: [empresaId], references: [id])
  /// Relaci√≥n con proveedor
  proveedor    Proveedor?         @relation(fields: [proveedorId], references: [id])
  /// Relaci√≥n con transporte
  transporte   Transporte?        @relation(fields: [transporteId], references: [id])

  @@map("cuentas_bancarias")
}

// =================================================================
// üöö LOG√çSTICA (Transporte y Entrega)
// =================================================================

/// Modelo de Transporte - Empresas de transporte para env√≠o de mercader√≠a.
/// Gestiona transportistas propios o terceros para entregas a clientes.
model Transporte {
  /// Identificador √∫nico
  id                   Int                  @id @default(autoincrement())
  /// Raz√≥n social del transporte
  razonSocial          String               @map("razon_social")
  /// RUC del transporte
  ruc                  String
  /// Direcci√≥n del transporte
  direccion            String?
  /// Tel√©fono de contacto
  telefono             String?
  /// Correo electr√≥nico
  email                String?
  /// Estado activo/inactivo
  estado               Boolean              @default(true)
  /// Fecha de creaci√≥n
  createdAt            DateTime             @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt            DateTime             @updatedAt @map("updated_at")
  /// Zona de cobertura del transporte
  cobertura            String?
  /// Departamento de ubicaci√≥n
  departamento         String?
  /// Distrito de ubicaci√≥n
  distrito             String?
  /// Provincia de ubicaci√≥n
  provincia            String?
  /// Contactos del transporte
  contactos            Contacto[]
  /// Cuentas bancarias del transporte
  cuentasBancarias     CuentaBancaria[]
  /// Saldos a favor o deudas con el transporte
  saldosTransporte     SaldoTransporte[]
  /// Asignaciones de transporte a √≥rdenes
  transportesAsignados TransporteAsignado[]

  @@map("transportes")
}

// =================================================================
// üè¢ ESTRUCTURA EMPRESARIAL (M√∫ltiples Razones Sociales)
// =================================================================

/// Modelo de Empresa - RAZONES SOCIALES del grupo distribuidor.
/// La empresa opera con m√∫ltiples razones sociales para facturar seg√∫n el cliente/venta.
/// Cada empresa tiene su RUC, cuentas bancarias y puede emitir sus propias facturas.
model Empresa {
  /// Identificador √∫nico
  id               Int              @id @default(autoincrement())
  /// Raz√≥n social de la empresa
  razonSocial      String           @map("razon_social")
  /// RUC de la empresa (√∫nico)
  ruc              String           @unique
  /// Direcci√≥n fiscal
  direccion        String?
  /// Tel√©fono de contacto
  telefono         String?
  /// Correo electr√≥nico
  email            String?
  /// Departamento de ubicaci√≥n
  departamento     String?
  /// Provincia de ubicaci√≥n
  provincia        String?
  /// Distrito de ubicaci√≥n
  distrito         String?
  /// URL del logo de la empresa
  logo             String?
  /// Direcciones adicionales
  direcciones      String?
  /// Sitio web
  web              String?
  /// Fecha de creaci√≥n
  createdAt        DateTime         @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt        DateTime         @updatedAt @map("updated_at")
  /// Cat√°logos de productos de la empresa
  catalogos        Catalogo[]
  /// Cotizaciones realizadas por la empresa
  cotizaciones     Cotizacion[]
  /// Cuentas bancarias de la empresa
  cuentasBancarias CuentaBancaria[]
  /// √ìrdenes de compra de la empresa
  ordenesCompra    OrdenCompra[]
  /// √ìrdenes de proveedor de la empresa
  ordenesProveedor OrdenProveedor[]

  @@map("empresas")
}

/// Modelo de Contacto - Personas de contacto de clientes, proveedores y transportes.
/// Permite gestionar m√∫ltiples contactos por entidad con informaci√≥n de comunicaci√≥n.
model Contacto {
  /// Identificador √∫nico
  id                   Int                  @id @default(autoincrement())
  /// Nombre completo del contacto
  nombre               String
  /// Tel√©fono del contacto
  telefono             String?
  /// Correo electr√≥nico del contacto
  email                String?
  /// Tipo de contacto (CLIENTE, PROVEEDOR, TRANSPORTE)
  tipo                 ContactoTipo
  /// ID de referencia del propietario
  referenciaId         Int                  @map("referencia_id")
  /// ID del cliente asociado (opcional)
  clienteId            Int?                 @map("cliente_id")
  /// ID del proveedor asociado (opcional)
  proveedorId          Int?                 @map("proveedor_id")
  /// ID del transporte asociado (opcional)
  transporteId         Int?                 @map("transporte_id")
  /// Cargo o puesto del contacto
  cargo                String?
  /// Fecha de creaci√≥n
  createdAt            DateTime             @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt            DateTime             @updatedAt @map("updated_at")
  /// Fecha de cumplea√±os
  cumpleanos           DateTime?
  /// Notas adicionales sobre el contacto
  nota                 String?
  /// Indica si es un contacto destacado
  usuarioDestacado     Boolean?             @map("usuario_destacado")
  /// Relaci√≥n con cliente
  cliente              Cliente?             @relation(fields: [clienteId], references: [id])
  /// Relaci√≥n con proveedor
  proveedor            Proveedor?           @relation(fields: [proveedorId], references: [id])
  /// Relaci√≥n con transporte
  transporte           Transporte?          @relation(fields: [transporteId], references: [id])
  /// Cotizaciones asociadas al contacto
  Cotizacion           Cotizacion[]
  /// √ìrdenes de compra donde es contacto
  ordenesCompra        OrdenCompra[]
  /// √ìrdenes de proveedor donde es contacto
  ordenesProveedor     OrdenProveedor[]
  /// Transportes asignados donde es contacto
  transportesAsignados TransporteAsignado[]

  @@map("contactos")
}

// =================================================================
// üì¶ CAT√ÅLOGOS Y PRODUCTOS
// =================================================================

/// Modelo de Cat√°logo - Cat√°logos de productos por empresa/raz√≥n social.
/// Cada empresa puede tener diferentes cat√°logos de productos.
model Catalogo {
  /// Identificador √∫nico
  id            Int           @id @default(autoincrement())
  /// Nombre del cat√°logo
  nombre        String
  /// Descripci√≥n del cat√°logo
  descripcion   String?
  /// ID de la empresa propietaria
  empresaId     Int           @map("empresa_id")
  /// Fecha de creaci√≥n
  createdAt     DateTime      @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt     DateTime      @updatedAt @map("updated_at")
  /// Relaci√≥n con empresa
  empresa       Empresa       @relation(fields: [empresaId], references: [id])
  /// √ìrdenes de compra asociadas al cat√°logo
  ordenesCompra OrdenCompra[]

  @@map("catalogos")
}

// =================================================================
// üìã PROCESO COMERCIAL (Cotizaci√≥n ‚Üí Venta)
// =================================================================

/// Modelo de Cotizaci√≥n - Propuesta comercial enviada a clientes.
/// Primer paso del flujo de ventas. Si el cliente aprueba, se genera una Orden de Compra.
model Cotizacion {
  /// Identificador √∫nico
  id                  Int                  @id @default(autoincrement())
  /// C√≥digo √∫nico de la cotizaci√≥n
  codigoCotizacion    String               @unique @map("codigo_cotizacion")
  /// ID de la empresa que emite la cotizaci√≥n
  empresaId           Int                  @map("empresa_id")
  /// ID del cliente destinatario
  clienteId           Int                  @map("cliente_id")
  /// ID del contacto del cliente
  contactoClienteId   Int?                 @map("contacto_cliente_id")
  /// Monto total de la cotizaci√≥n
  montoTotal          Decimal              @map("monto_total")
  /// Tipo de pago propuesto
  tipoPago            TipoPago             @map("tipo_pago")
  /// Notas sobre el pago
  notaPago            String?              @map("nota_pago")
  /// Notas sobre el pedido
  notaPedido          String?              @map("nota_pedido")
  /// Direcci√≥n de entrega
  direccionEntrega    String?              @map("direccion_entrega")
  /// Distrito de entrega
  distritoEntrega     String?              @map("distrito_entrega")
  /// Provincia de entrega
  provinciaEntrega    String?              @map("provincia_entrega")
  /// Departamento de entrega
  departamentoEntrega String?              @map("departamento_entrega")
  /// Referencia de entrega
  referenciaEntrega   String?              @map("referencia_entrega")
  /// Estado de la cotizaci√≥n
  estado              CotizacionEstado     @default(PENDIENTE)
  /// Fecha de la cotizaci√≥n
  fechaCotizacion     DateTime             @map("fecha_cotizacion")
  /// Fecha estimada de entrega
  fechaEntrega        DateTime?            @map("fecha_entrega")
  /// Fecha de creaci√≥n
  createdAt           DateTime             @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt           DateTime             @updatedAt @map("updated_at")
  /// Productos incluidos en la cotizaci√≥n
  productos           CotizacionProducto[]
  /// Relaci√≥n con cliente
  cliente             Cliente              @relation(fields: [clienteId], references: [id])
  /// Relaci√≥n con contacto del cliente
  contactoCliente     Contacto?            @relation(fields: [contactoClienteId], references: [id])
  /// Relaci√≥n con empresa
  empresa             Empresa              @relation(fields: [empresaId], references: [id])

  @@map("cotizaciones")
}

/// Modelo de Producto de Cotizaci√≥n - L√≠neas de productos incluidos en una cotizaci√≥n.
model CotizacionProducto {
  /// Identificador √∫nico
  id              Int        @id @default(autoincrement())
  /// C√≥digo del producto
  codigo          String
  /// Descripci√≥n del producto
  descripcion     String
  /// Unidad de medida
  unidadMedida    String?    @map("unidad_medida")
  /// Cantidad solicitada
  cantidad        Int
  /// Cantidad disponible en almac√©n
  cantidadAlmacen Int?       @map("cantidad_almacen")
  /// Cantidad total
  cantidadTotal   Int        @map("cantidad_total")
  /// Precio unitario
  precioUnitario  Decimal    @map("precio_unitario")
  /// Total del producto
  total           Decimal
  /// ID de la cotizaci√≥n
  cotizacionId    Int        @map("cotizacion_id")
  /// Fecha de creaci√≥n
  createdAt       DateTime   @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt       DateTime   @updatedAt @map("updated_at")
  /// Cantidad para el cliente
  cantidadCliente Int?       @map("cantidad_cliente")
  /// Relaci√≥n con cotizaci√≥n
  cotizacion      Cotizacion @relation(fields: [cotizacionId], references: [id])

  @@map("cotizacion_productos")
}

// =================================================================
// üõí ORDEN DE COMPRA = VENTA (Modelo Principal del Negocio)
// =================================================================

/// Modelo de Orden de Compra (OC) - ‚ö†Ô∏è REPRESENTA UNA VENTA.
/// El cliente nos emite una OC = nosotros vendemos.
/// 
/// VENTAS AL ESTADO:
/// - Tienen documentoOce (Orden de Compra Electr√≥nica) y/o documentoOcf (f√≠sica)
/// - Requieren seguimiento SIAF para cobro
/// - Pueden tener penalidades por incumplimiento
/// - Se gestionan estados de cobranza (REQ, REIT1, REIT2, etc.)
/// 
/// VENTAS PRIVADAS (ventaPrivada = true):
/// - Datos adicionales en OrdenCompraPrivada
/// - Flujo de facturaci√≥n y cobro simplificado
model OrdenCompra {
  /// Identificador √∫nico
  id                            Int                   @id @default(autoincrement())
  /// C√≥digo √∫nico de la venta
  codigoVenta                   String                @unique @map("codigo_venta")
  /// Fecha de emisi√≥n de la orden
  fechaEmision                  DateTime?             @map("fecha_emision") @db.Date
  /// Archivo de la orden de compra
  archivoOc                     String?               @map("archivo_oc")
  /// ID de la empresa vendedora
  empresaId                     Int?                  @map("empresa_id")
  /// ID del cliente comprador
  clienteId                     Int?                  @map("cliente_id")
  /// ID del contacto del cliente
  contactoClienteId             Int?                  @map("contacto_cliente_id")
  /// ID del cat√°logo de la empresa
  catalogoEmpresaId             Int?                  @map("catalogo_empresa_id")
  /// Indica si es una venta privada (no al Estado)
  ventaPrivada                  Boolean               @default(false) @map("venta_privada")
  /// Provincia de entrega
  provinciaEntrega              String?               @map("provincia_entrega")
  /// Distrito de entrega
  distritoEntrega               String?               @map("distrito_entrega")
  /// Departamento de entrega
  departamentoEntrega           String?               @map("departamento_entrega")
  /// Direcci√≥n de entrega
  direccionEntrega              String?               @map("direccion_entrega")
  /// Referencia de entrega
  referenciaEntrega             String?               @map("referencia_entrega")
  /// Fecha de entrega programada
  fechaEntrega                  DateTime?             @map("fecha_entrega") @db.Date
  /// Monto total de la venta
  montoVenta                    Decimal?              @map("monto_venta") @db.Decimal(10, 2)
  /// Fecha del formulario
  fechaForm                     DateTime?             @map("fecha_form") @db.Date
  /// Fecha m√°xima del formulario
  fechaMaxForm                  DateTime?             @map("fecha_max_form") @db.Date
  /// Productos en formato JSON
  productos                     Json?
  /// Documento de orden de compra electr√≥nica
  documentoOce                  String?               @map("documento_oce")
  /// Documento de orden de compra f√≠sica
  documentoOcf                  String?               @map("documento_ocf")
  /// N√∫mero SIAF
  siaf                          String?
  /// Etapa del SIAF
  etapaSiaf                     String?               @map("etapa_siaf")
  /// Fecha del SIAF
  fechaSiaf                     DateTime?             @map("fecha_siaf") @db.Date
  /// Documento de Per√∫ Compras
  documentoPeruCompras          String?               @map("documento_peru_compras")
  /// Fecha de Per√∫ Compras
  fechaPeruCompras              DateTime?             @map("fecha_peru_compras") @db.Date
  /// Fecha de entrega seg√∫n OC
  fechaEntregaOc                DateTime?             @map("fecha_entrega_oc") @db.Date
  /// Monto de penalidad aplicada
  penalidad                     Decimal?              @db.Decimal(10, 2)
  /// Monto neto cobrado
  netoCobrado                   Decimal?              @map("neto_cobrado") @db.Decimal(10, 2)
  /// Fecha del estado de cobranza
  fechaEstadoCobranza           DateTime?             @map("fecha_estado_cobranza") @db.Date
  /// Fecha de pr√≥xima gesti√≥n de cobranza
  fechaProximaGestion           DateTime?             @map("fecha_proxima_gestion") @db.Date
  /// Etapa actual del proceso
  etapaActual                   String                @default("creacion") @map("etapa_actual")
  /// Estado activo de la orden
  estadoActivo                  Boolean               @default(true) @map("estado_activo")
  /// Fecha de creaci√≥n
  createdAt                     DateTime              @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt                     DateTime              @updatedAt @map("updated_at")
  /// C√≥digo de la OCF
  codigoOcf                     String?               @map("codigo_ocf")
  /// Estado de cobranza (REQ, REIT1, etc.)
  estadoCobranza                EstadoCobranza?       @map("estado_cobranza")
  /// Indica si tiene m√∫ltiples fuentes de financiamiento
  multipleFuentesFinanciamiento Boolean               @default(false) @map("multiple_fuentes_financiamiento")
  /// Estado del rol de seguimiento
  estadoRolSeguimiento          EstadoRol             @default(PENDIENTE) @map("estado_rol_seguimiento")
  /// Nota de cobranzas en seguimiento por OC
  notaCobranzaSeguimiento       String?               @map("nota_cobranza_seguimiento")
  /// Estado general de la venta
  estadoVenta                   EstadoRol             @default(PENDIENTE) @map("estado_venta")
  /// ID del cobrador asignado
  cobradorId                    Int?                  @map("cobrador_id")
  /// Archivo de carta CCI
  cartaCci                      String?               @map("carta_cci")
  /// Archivo de carta de garant√≠a
  cartaGarantia                 String?               @map("carta_garantia")
  /// Archivo de carta de ampliaci√≥n
  cartaAmpliacion               String?               @map("carta_ampliacion")
  /// Estado de facturaci√≥n
  estadoFacturacion             EstadoRol             @default(PENDIENTE) @map("estado_facturacion")
  /// Estado del rol de cobranza
  estadoCobranzaRol             EstadoRol             @default(PENDIENTE) @map("estado_cobranza_rol")
  /// Archivos adjuntos de la orden
  archivosAdjuntos              ArchivoAdjunto[]
  /// Facturaciones asociadas
  facturaciones                 Facturacion[]
  /// Gestiones de cobranza realizadas
  gestionCobranzas              GestionCobranza[]
  /// Relaci√≥n con cat√°logo de empresa
  catalogoEmpresa               Catalogo?             @relation(fields: [catalogoEmpresaId], references: [id])
  /// Relaci√≥n con cliente
  cliente                       Cliente?              @relation(fields: [clienteId], references: [id])
  /// Relaci√≥n con cobrador asignado
  cobrador                      Usuario?              @relation("CobradorOrdenCompra", fields: [cobradorId], references: [id])
  /// Relaci√≥n con contacto del cliente
  contactoCliente               Contacto?             @relation(fields: [contactoClienteId], references: [id])
  /// Relaci√≥n con empresa
  empresa                       Empresa?              @relation(fields: [empresaId], references: [id])
  /// Agrupaciones de √≥rdenes de compra
  OrdenCompraAgrupada           OrdenCompraAgrupada[]
  /// Datos de venta privada (si aplica)
  ordenCompraPrivada            OrdenCompraPrivada?
  /// √ìrdenes de proveedor asociadas
  ordenesProveedor              OrdenProveedor[]
  /// Programaciones de entrega
  programacionesEntrega         ProgramacionEntrega[]

  @@map("ordenes_compra")
}

/// Modelo de Agrupaci√≥n de Orden de Compra - Permite agrupar m√∫ltiples OCs para gesti√≥n conjunta.
/// √ötil cuando un cliente tiene varias OCs que se procesan o facturan juntas.
model AgrupacionOrdenCompra {
  /// Identificador √∫nico
  id            Int                   @id @default(autoincrement())
  /// C√≥digo √∫nico del grupo
  codigoGrupo   String                @unique @map("codigo_grupo") @db.VarChar(255)
  /// Descripci√≥n del grupo
  descripcion   String?
  /// Fecha de creaci√≥n del grupo
  fecha         DateTime              @default(now())
  /// Fecha de creaci√≥n
  createdAt     DateTime              @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt     DateTime              @updatedAt @map("updated_at")
  /// √ìrdenes de compra en el grupo
  ordenesCompra OrdenCompraAgrupada[]

  @@map("agrupaciones_orden_compra")
}

/// Modelo de Orden de Compra Agrupada - Tabla pivote entre agrupaci√≥n y √≥rdenes de compra.
model OrdenCompraAgrupada {
  /// Identificador √∫nico
  id                      Int                   @id @default(autoincrement())
  /// ID de la agrupaci√≥n
  agrupacionOrdenCompraId Int                   @map("agrupacion_orden_compra_id")
  /// ID de la orden de compra
  ordenCompraId           Int                   @map("orden_compra_id")
  /// Fecha de creaci√≥n
  createdAt               DateTime              @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt               DateTime              @updatedAt @map("updated_at")
  /// Relaci√≥n con agrupaci√≥n
  agrupacion              AgrupacionOrdenCompra @relation(fields: [agrupacionOrdenCompraId], references: [id])
  /// Relaci√≥n con orden de compra
  ordenCompra             OrdenCompra           @relation(fields: [ordenCompraId], references: [id])

  @@map("ordenes_compra_agrupadas")
}

// =================================================================
// üè™ VENTAS PRIVADAS (No al Estado)
// =================================================================

/// Modelo de Orden de Compra Privada - Datos espec√≠ficos para ventas a clientes privados.
/// Extiende OrdenCompra con campos adicionales para el flujo simplificado de ventas privadas.
model OrdenCompraPrivada {
  /// Identificador √∫nico
  id                  Int                      @id @default(autoincrement())
  /// ID de la orden de compra asociada
  ordenCompraId       Int                      @unique @map("orden_compra_id")
  /// Fecha de pago
  fechaPago           DateTime?                @map("fecha_pago") @db.Date
  /// Fecha de la factura
  fechaFactura        DateTime?                @map("fecha_factura") @db.Date
  /// Documento de pago
  documentoPago       String?                  @map("documento_pago")
  /// Fecha de creaci√≥n
  createdAt           DateTime                 @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt           DateTime                 @updatedAt @map("updated_at")
  /// Estado del pago
  estadoPago          EstadoPago?              @map("estado_pago")
  /// Estado de la factura
  estadoFactura       String?                  @map("estado_factura")
  /// Notas sobre el pago
  notaPago            String?                  @map("nota_pago")
  /// Documento de cotizaci√≥n
  documentoCotizacion String?                  @map("documento_cotizacion")
  /// N√∫mero de cotizaci√≥n
  cotizacion          String?                  @map("cotizacion")
  /// Destino final de la entrega
  destinoFinal        String?                  @map("destino_final")
  /// Nombre de la agencia (si aplica)
  nombreAgencia       String?                  @map("nombre_agencia")
  /// Nombre de la entidad (si aplica)
  nombreEntidad       String?                  @map("nombre_entidad")
  /// Tipo de destino de entrega
  tipoDestino         TipoEntregaPrivada?      @map("tipo_destino")
  /// Gestiones de cobranza asociadas
  gestionCobranzas    GestionCobranza[]
  /// Relaci√≥n con orden de compra
  ordenCompra         OrdenCompra              @relation(fields: [ordenCompraId], references: [id])
  /// Pagos registrados
  pagos               PagoOrdenCompraPrivada[]

  @@index([estadoPago], map: "idx_estado_pago_privada")
  @@map("ordenes_compra_privadas")
}

/// Modelo de Pago de Orden de Compra Privada - Registra pagos recibidos de clientes privados.
/// Permite control de pagos parciales con verificaci√≥n de vouchers.
model PagoOrdenCompraPrivada {
  /// Identificador √∫nico
  id                   Int                @id @default(autoincrement())
  /// ID de la orden de compra privada
  ordenCompraPrivadaId Int                @map("orden_compra_privada_id")
  /// Fecha del pago
  fechaPago            DateTime?          @map("fecha_pago") @db.Date
  /// Banco donde se realiz√≥ el pago
  bancoPago            String?            @map("banco_pago")
  /// Descripci√≥n del pago
  descripcionPago      String?            @map("descripcion_pago")
  /// Archivo/voucher del pago
  archivoPago          String?            @map("archivo_pago")
  /// Monto del pago
  montoPago            Decimal?           @map("monto_pago") @db.Decimal(10, 2)
  /// Estado de verificaci√≥n del pago
  estadoPago           Boolean            @default(false) @map("estado_pago")
  /// Fecha de creaci√≥n
  createdAt            DateTime           @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt            DateTime           @updatedAt @map("updated_at")
  /// Relaci√≥n con orden de compra privada
  ordenCompraPrivada   OrdenCompraPrivada @relation(fields: [ordenCompraPrivadaId], references: [id])

  @@map("pagos_ordenes_compra_privadas")
}

// =================================================================
// üì§ ORDEN DE PROVEEDOR (Compras a Proveedores)
// =================================================================

/// Modelo de Orden de Proveedor (OP) - Pedidos que hacemos a NUESTROS proveedores.
/// Se genera cuando tenemos una venta confirmada (OC) y necesitamos mercader√≠a.
/// Una OC puede generar m√∫ltiples OPs a diferentes proveedores.
model OrdenProveedor {
  /// Identificador √∫nico
  id                      Int                         @id @default(autoincrement())
  /// C√≥digo √∫nico de la orden de proveedor
  codigoOp                String                      @map("codigo_op") @db.VarChar(255)
  /// ID de la empresa que realiza el pedido
  empresaId               Int?                        @map("empresa_id")
  /// ID del proveedor
  proveedorId             Int?                        @map("proveedor_id")
  /// ID del contacto del proveedor
  contactoProveedorId     Int?                        @map("contacto_proveedor_id")
  /// Fecha de despacho
  fechaDespacho           DateTime?                   @map("fecha_despacho")
  /// Fecha programada de entrega
  fechaProgramada         DateTime?                   @map("fecha_programada")
  /// Fecha de recepci√≥n
  fechaRecepcion          DateTime?                   @map("fecha_recepcion")
  /// Notas del pedido
  notaPedido              String?                     @map("nota_pedido")
  /// Total a pagar al proveedor
  totalProveedor          Decimal?                    @map("total_proveedor")
  /// Tipo de pago acordado
  tipoPago                String?                     @map("tipo_pago")
  /// Forma de pago
  formaPago               String?                     @map("forma_pago")
  /// Notas sobre el pago
  notaPago                String?                     @map("nota_pago")
  /// Notas de gesti√≥n de la OP
  notaGestionOp           String?                     @map("nota_gestion_op")
  /// Tipo de entrega
  tipoEntrega             String?                     @map("tipo_entrega")
  /// Informaci√≥n de retorno de mercader√≠a
  retornoMercaderia       String?                     @map("retorno_mercaderia")
  /// Estado de la orden de proveedor
  estadoOp                String?                     @map("estado_op")
  /// Fecha de entrega (texto)
  fechaEntrega            String?                     @map("fecha_entrega")
  /// Cargo OEA
  cargoOea                String?                     @map("cargo_oea")
  /// Informaci√≥n de etiquetado
  etiquetado              String?
  /// Informaci√≥n de embalaje
  embalaje                String?
  /// Observaciones generales
  observaciones           String?
  /// Notas adicionales
  notaAdicional           String?                     @map("nota_adicional")
  /// Estado activo de la orden
  activo                  Boolean                     @default(true)
  /// ID de la orden de compra asociada
  ordenCompraId           Int?                        @map("orden_compra_id")
  /// Fecha de creaci√≥n
  createdAt               DateTime?                   @default(now()) @map("created_at") @db.Timestamp(6)
  /// Fecha de actualizaci√≥n
  updatedAt               DateTime?                   @updatedAt @map("updated_at") @db.Timestamp(6)
  /// Estado del rol de la OP
  estadoRolOp             EstadoRol                   @default(PENDIENTE) @map("estado_rol_op")
  /// Estado del rol de seguimiento
  estadoRolSeguimiento    EstadoRol                   @default(PENDIENTE) @map("estado_rol_seguimiento")
  /// Notas para cobranzas
  notaCobranzas           String?                     @map("nota_cobranzas")
  /// Notas de observaciones
  notaObservaciones       String?                     @map("nota_observaciones")
  /// Indica si la orden est√° completada
  isCompleted             Boolean                     @default(false) @map("is_completed")
  /// Costos adicionales de la orden
  costosAdicionales       CostoAdicionalOp[]
  /// Historial de modificaciones
  historialModificaciones HistorialModificacionesOp[]
  /// Relaci√≥n con contacto del proveedor
  contactoProveedor       Contacto?                   @relation(fields: [contactoProveedorId], references: [id])
  /// Relaci√≥n con empresa
  empresa                 Empresa?                    @relation(fields: [empresaId], references: [id])
  /// Relaci√≥n con orden de compra
  ordenCompra             OrdenCompra?                @relation(fields: [ordenCompraId], references: [id])
  /// Relaci√≥n con proveedor
  proveedor               Proveedor?                  @relation(fields: [proveedorId], references: [id])
  /// Pagos realizados al proveedor
  pagos                   PagoOrdenProveedor[]
  /// Productos de la orden
  productos               OpProducto[]
  /// Programaciones de entrega
  programacionesEntrega   ProgramacionEntrega[]
  /// Transportes asignados
  transportesAsignados    TransporteAsignado[]

  @@index([tipoPago], map: "idx_tipo_pago")
  @@map("ordenes_proveedor")
}

/// Modelo de Producto de Orden de Proveedor - L√≠neas de productos en una OP.
/// Detalle de cada producto solicitado al proveedor con cantidad y precio.
model OpProducto {
  /// Identificador √∫nico
  id               Int            @id @default(autoincrement())
  /// C√≥digo del producto
  codigo           String
  /// Descripci√≥n del producto
  descripcion      String
  /// Unidad de medida
  unidadMedida     String?        @map("unidad_medida")
  /// Cantidad solicitada
  cantidad         Int
  /// Cantidad en almac√©n
  cantidadAlmacen  Int?           @map("cantidad_almacen")
  /// Cantidad total
  cantidadTotal    Int            @map("cantidad_total")
  /// Precio unitario
  precioUnitario   Decimal        @map("precio_unitario")
  /// Total del producto
  total            Decimal
  /// ID de la orden de proveedor
  ordenProveedorId Int            @map("orden_proveedor_id")
  /// Fecha de creaci√≥n
  createdAt        DateTime       @default(now()) @map("created_at")
  /// Fecha de actualizaci√≥n
  updatedAt        DateTime       @updatedAt @map("updated_at")
  /// Cantidad para el cliente
  cantidadCliente  Int?           @map("cantidad_cliente")
  /// Relaci√≥n con orden de proveedor
  ordenProveedor   OrdenProveedor @relation(fields: [ordenProveedorId], references: [id])

  @@map("productos_orden_proveedor")
}

// =================================================================
// üöö TRANSPORTE Y ENTREGAS
// =================================================================

/// Modelo de Transporte Asignado - Asignaci√≥n de transportista a una orden de proveedor.
/// Gestiona el env√≠o de mercader√≠a desde proveedor a cliente o almac√©n.
model TransporteAsignado {
  /// Identificador √∫nico
  id                   Int                      @id @default(autoincrement())
  codigoTransporte     String                   @map("codigo_transporte")
  transporteId         Int                      @map("transporte_id")
  ordenProveedorId     Int                      @map("orden_proveedor_id")
  contactoTransporteId Int?                     @map("contacto_transporte_id")
  region               String?
  provincia            String?
  distrito             String?
  direccion            String?
  notaTransporte       String?                  @map("nota_transporte")
  cotizacionTransporte String?                  @map("cotizacion_transporte")
  montoFlete           Decimal?                 @map("monto_flete") @db.Decimal(10, 2)
  grt                  String?
  createdAt            DateTime                 @default(now()) @map("created_at")
  updatedAt            DateTime                 @updatedAt @map("updated_at")
  tipoDestino          TipoDestino              @map("tipo_destino")
  estadoPago           EstadoPago?              @map("estado_pago")
  notaPago             String?                  @map("nota_pago")
  almacenId            Int?                     @map("almacen_id")
  guiaRemision         String?                  @map("guia_remision")
  guiaTransporte       String?                  @map("guia_transporte")
  montoFletePagado     Decimal?                 @map("monto_flete_pagado") @db.Decimal(10, 2)
  numeroFactura        String?                  @map("numero_factura")
  archivoFactura       String?                  @map("archivo_factura")
  pagos                PagoTransporteAsignado[]
  almacen              Almacen?                 @relation(fields: [almacenId], references: [id])
  contactoTransporte   Contacto?                @relation(fields: [contactoTransporteId], references: [id])
  ordenProveedor       OrdenProveedor           @relation(fields: [ordenProveedorId], references: [id])
  transporte           Transporte               @relation(fields: [transporteId], references: [id])

  @@index([estadoPago], map: "idx_estado_pago")
  @@map("transportes_asignados")
}

/// Modelo de Pago de Transporte Asignado - Pagos realizados al transportista.
model PagoTransporteAsignado {
  id                   Int                @id @default(autoincrement())
  transporteAsignadoId Int                @map("transporte_asignado_id")
  fechaPago            DateTime?          @map("fecha_pago") @db.Date
  bancoPago            String?            @map("banco_pago")
  descripcionPago      String?            @map("descripcion_pago")
  archivoPago          String?            @map("archivo_pago")
  montoPago            Decimal?           @map("monto_pago") @db.Decimal(10, 2)
  estadoPago           Boolean?           @default(false) @map("estado_pago")
  activo               Boolean?           @default(true)
  createdAt            DateTime           @default(now()) @map("created_at")
  updatedAt            DateTime           @updatedAt @map("updated_at")
  transporteAsignado   TransporteAsignado @relation(fields: [transporteAsignadoId], references: [id])

  @@map("pagos_transportes_asignados")
}

/// Modelo de Pago de Orden de Proveedor - Pagos realizados a proveedores por las OPs.
/// Permite pagos parciales y registro de vouchers de pago.
model PagoOrdenProveedor {
  id               Int             @id @default(autoincrement())
  fechaPago        DateTime?       @map("fecha_pago")
  bancoPago        String?         @map("banco_pago") @db.VarChar(255)
  descripcionPago  String?         @map("descripcion_pago")
  archivoPago      String?         @map("archivo_pago") @db.VarChar(255)
  montoPago        Decimal?        @map("monto_pago") @db.Decimal(10, 4)
  estadoPago       Boolean         @default(false) @map("estado_pago")
  activo           Boolean         @default(true)
  ordenProveedorId Int?            @map("orden_proveedor_id")
  createdAt        DateTime?       @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt        DateTime?       @updatedAt @map("updated_at") @db.Timestamp(6)
  ordenProveedor   OrdenProveedor? @relation(fields: [ordenProveedorId], references: [id])

  @@map("pagos_orden_proveedor")
}

// =================================================================
// üì¶ INVENTARIO Y ALMAC√âN
// =================================================================

/// Modelo de Producto - Cat√°logo maestro de productos manejados.
model Producto {
  id               Int               @id @default(autoincrement())
  nombre           String
  descripcion      String?
  unidadMedida     String?           @map("unidad_medida")
  precioBase       Decimal?          @map("precio_base") @db.Decimal(10, 4)
  estado           Boolean?          @default(true)
  createdAt        DateTime          @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime          @updatedAt @map("updated_at")
  movimientosStock MovimientoStock[]
  stockProductos   StockProducto[]

  @@map("productos")
}

/// Modelo de Stock de Producto - Control de inventario por producto y almac√©n.
model StockProducto {
  id         Int      @id @default(autoincrement())
  productoId Int      @map("producto_id")
  almacenId  Int      @map("almacen_id")
  cantidad   Int      @default(0)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  almacen    Almacen  @relation(fields: [almacenId], references: [id])
  producto   Producto @relation(fields: [productoId], references: [id])

  @@unique([productoId, almacenId])
  @@map("stock_productos")
}

/// Modelo de Movimiento de Stock - Historial de entradas y salidas de inventario.
model MovimientoStock {
  id         Int      @id @default(autoincrement())
  productoId Int      @map("producto_id")
  almacenId  Int      @map("almacen_id")
  cantidad   Int
  tipo       String
  referencia String?
  createdAt  DateTime @default(now()) @map("created_at")
  almacen    Almacen  @relation(fields: [almacenId], references: [id])
  producto   Producto @relation(fields: [productoId], references: [id])

  @@map("movimientos_stock")
}

/// Modelo de Almac√©n - Ubicaciones f√≠sicas de almacenamiento de mercader√≠a.
model Almacen {
  id                   Int                  @id @default(autoincrement())
  nombre               String
  direccion            String?
  ciudad               String?
  createdAt            DateTime             @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime             @updatedAt @map("updated_at")
  movimientosStock     MovimientoStock[]
  stockProductos       StockProducto[]
  transportesAsignados TransporteAsignado[]

  @@map("almacenes")
}

// =================================================================
// üßæ FACTURACI√ìN Y COBRANZA
// =================================================================

/// Modelo de Facturaci√≥n - Facturas emitidas por cada venta (OC).
/// Gestiona facturaci√≥n, notas de cr√©dito y refacturaci√≥n.
model Facturacion {
  id                  Int           @id @default(autoincrement())
  ordenCompraId       Int           @map("orden_compra_id")
  factura             String?
  fechaFactura        DateTime?     @map("fecha_factura") @db.Date
  grr                 String?
  retencion           Decimal?      @db.Decimal(10, 2)
  detraccion          Decimal?      @db.Decimal(10, 2)
  formaEnvioFactura   String?       @map("forma_envio_factura")
  estado              Int?          @default(1)
  createdAt           DateTime      @default(now()) @map("created_at")
  updatedAt           DateTime      @updatedAt @map("updated_at")
  notaCreditoArchivo  String?       @map("nota_credito_archivo")
  notaCreditoTexto    String?       @map("nota_credito_texto")
  esRefacturacion     Boolean       @default(false) @map("es_refacturacion")
  idFacturaOriginal   Int?          @map("id_factura_original")
  facturaArchivo      String?       @map("factura_archivo")
  grrArchivo          String?       @map("grr_archivo")
  motivoRefacturacion String?       @map("motivo_refacturacion")
  facturaOriginal     Facturacion?  @relation("Refacturacion", fields: [idFacturaOriginal], references: [id])
  refacturaciones     Facturacion[] @relation("Refacturacion")
  ordenCompra         OrdenCompra   @relation(fields: [ordenCompraId], references: [id])

  @@map("facturaciones")
}

/// Modelo de Gesti√≥n de Cobranza - Registro de gestiones realizadas para cobrar facturas.
/// Estados de cobranza para ventas al Estado: REQ ‚Üí REIT1 ‚Üí REIT2 ‚Üí OCI ‚Üí PC ‚Üí MAXIMA_AUTORIDAD ‚Üí etc.
model GestionCobranza {
  id                           Int                 @id @default(autoincrement())
  ordenCompraId                Int?                @map("orden_compra_id")
  fechaGestion                 DateTime            @map("fecha_gestion")
  createdAt                    DateTime            @default(now()) @map("created_at")
  updatedAt                    DateTime            @updatedAt @map("updated_at")
  archivosAdjuntosNotasGestion String[]            @map("archivos_adjuntos_notas_gestion")
  capturaEnvioDocumentoUrl     String?             @map("captura_envio_documento_url")
  cartaAmpliacionUrl           String?             @map("carta_ampliacion_url")
  documentosRegistrados        String[]            @map("documentos_registrados")
  notaEspecialEntrega          String?             @map("nota_especial_entrega")
  notaGestion                  String?             @map("nota_gestion")
  ordenCompraPrivadaId         Int?                @map("orden_compra_privada_id")
  pagoConformeTesoreria        Boolean?            @default(false) @map("pago_conforme_tesoreria")
  tipoCobranza                 TipoCobranza?       @map("tipo_cobranza")
  usuarioId                    Int                 @map("usuario_id")
  voucherPagoUrl               String?             @map("voucher_pago_url")
  estadoCobranza               EstadoCobranza?     @map("estado_cobranza")
  ordenCompra                  OrdenCompra?        @relation(fields: [ordenCompraId], references: [id])
  ordenCompraPrivada           OrdenCompraPrivada? @relation(fields: [ordenCompraPrivadaId], references: [id])
  usuario                      Usuario             @relation(fields: [usuarioId], references: [id])

  @@map("gestion_cobranzas")
}

// =================================================================
// üë§ USUARIOS Y SEGURIDAD
// =================================================================

/// Modelo de Usuario - Usuarios del sistema con roles y permisos.
model Usuario {
  id                      Int                         @id @default(autoincrement())
  nombre                  String
  email                   String                      @unique
  password                String
  role                    Role                        @default(USER)
  foto                    String?
  estado                  Boolean                     @default(true)
  createdAt               DateTime                    @default(now()) @map("created_at")
  updatedAt               DateTime                    @updatedAt @map("updated_at")
  departamento            String?
  telefono                String?
  ubicacion               String?
  permisos                String[]                    @default([])
  gestionCobranzas        GestionCobranza[]
  historialModificaciones HistorialModificacionesOp[]
  ordenesCompra           OrdenCompra[]               @relation("CobradorOrdenCompra")
  programacionesEntrega   ProgramacionEntrega[]       @relation("ResponsableProgramacion")

  @@map("usuarios")
}

/// Modelo de Historial de Modificaciones de OP - Auditor√≠a de cambios en √≥rdenes de proveedor.
model HistorialModificacionesOp {
  id                Int            @id @default(autoincrement())
  ordenProveedorId  Int            @map("orden_proveedor_id")
  usuarioId         Int            @map("usuario_id")
  campoModificado   String         @map("campo_modificado")
  valorAnterior     String?        @map("valor_anterior")
  valorNuevo        String?        @map("valor_nuevo")
  fechaModificacion DateTime       @default(now()) @map("fecha_modificacion")
  motivo            String?
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")
  ordenProveedor    OrdenProveedor @relation(fields: [ordenProveedorId], references: [id])
  usuario           Usuario        @relation(fields: [usuarioId], references: [id])

  @@map("historial_modificaciones_op")
}

/// Modelo de Programaci√≥n de Entrega - Planificaci√≥n de entregas a clientes.
/// Puede estar asociada a una OC o una OP.
model ProgramacionEntrega {
  id                   Int                  @id @default(autoincrement())
  ordenProveedorId     Int?                 @map("orden_proveedor_id")
  ordenCompraId        Int?                 @map("orden_compra_id")
  tipoProgramacion     TipoProgramacionOp   @map("tipo_programacion")
  estadoProgramacion   EstadoProgramacionOp @map("estado_programacion")
  responsableEntregaId Int?                 @map("responsable_entrega_id")
  fechaMaximaEntrega   DateTime?            @map("fecha_maxima_entrega")
  monto                Decimal?
  ordenElectronica     String?              @map("orden_electronica_prog")
  ordenFisica          String?              @map("orden_fisica_prog")
  departamentoEntrega  String?              @map("departamento_entrega_prog")
  provinciaEntrega     String?              @map("provincia_entrega_prog")
  distritoEntrega      String?              @map("distrito_entrega_prog")
  documentosAdjuntos   String[]             @map("documentos_adjuntos_prog")
  nota                 String?              @map("nota_prog")
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  ordenCompra          OrdenCompra?         @relation(fields: [ordenCompraId], references: [id])
  ordenProveedor       OrdenProveedor?      @relation(fields: [ordenProveedorId], references: [id])
  responsableEntrega   Usuario?             @relation("ResponsableProgramacion", fields: [responsableEntregaId], references: [id])

  @@map("programaciones_entrega")
}

/// Modelo de Costo Adicional de OP - Gastos extra en √≥rdenes de proveedor (embalaje, etc.)
model CostoAdicionalOp {
  id               Int            @id @default(autoincrement())
  ordenProveedorId Int            @map("orden_proveedor_id")
  concepto         String
  descripcion      String?
  comprobanteUrl   String?        @map("comprobante_url")
  monto            Decimal
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  ordenProveedor   OrdenProveedor @relation(fields: [ordenProveedorId], references: [id])

  @@map("costos_adicionales_op")
}

/// Modelo de Archivo Adjunto - Documentos adjuntos a √≥rdenes de compra.
model ArchivoAdjunto {
  id            Int         @id @default(autoincrement())
  ordenCompraId Int         @map("orden_compra_id")
  nombre        String
  url           String
  tipo          String
  tamano        Int
  descripcion   String?
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")
  ordenCompra   OrdenCompra @relation(fields: [ordenCompraId], references: [id])

  @@map("archivos_adjuntos")
}

// =================================================================
// üìå ENUMERACIONES (Estados y Tipos)
// =================================================================

/// Tipo de destino para transporte asignado
enum TipoDestino {
  ALMACEN /// Entrega a almac√©n propio
  CLIENTE /// Entrega directa al cliente
  AGENCIA /// Entrega a agencia de transporte
}

/// Tipo de entrega para ventas privadas
enum TipoEntregaPrivada {
  ENTREGA_DOMICILIO /// Entrega en domicilio del cliente
  ENTREGA_AGENCIA /// Entrega en agencia de transporte
  RECOJO_ALMACEN /// Cliente recoge en almac√©n
}

/// Tipo de contacto seg√∫n la entidad relacionada
enum ContactoTipo {
  CLIENTE
  PROVEEDOR
  TRANSPORTE
}

/// Estados de cotizaci√≥n
enum CotizacionEstado {
  PENDIENTE /// Cotizaci√≥n enviada, esperando respuesta
  APROBADO /// Cliente aprob√≥ la cotizaci√≥n
  COTIZADO /// Cotizaci√≥n completada
}

/// Estados de orden de compra (venta)
enum OrdenCompraEstado {
  PENDIENTE /// Venta en proceso
  FACTURADA /// Venta facturada
  CANCELADA /// Venta cancelada
}

/// Estados de orden de proveedor
enum OrdenProveedorEstado {
  PENDIENTE /// Pedido enviado al proveedor
  RECIBIDA /// Mercader√≠a recibida
  ANULADA /// Pedido anulado
}

/// Roles de usuario en el sistema
enum Role {
  ADMIN /// Administrador con acceso total
  USER /// Usuario con acceso limitado seg√∫n permisos
}

/// Tipos de pago acordados
enum TipoPago {
  CONTADO /// Pago inmediato
  CREDITO /// Pago a plazo
  ANTICIPADO /// Pago antes de despacho
  OTROS /// Otros acuerdos
}

/// Tipo de movimiento de saldo con proveedor
enum MovimientoProveedor {
  A_FAVOR /// Proveedor nos debe (pagamos de m√°s)
  DEBE /// Debemos al proveedor
}

/// Estados generales de seguimiento (usado en varios contextos)
enum EstadoRol {
  PENDIENTE /// Por procesar
  COMPLETADO /// Finalizado exitosamente
  CANCELADO /// Cancelado
  EN_PROCESO /// En ejecuci√≥n
  ENTREGADO /// Mercader√≠a entregada
  COMPLETO /// Proceso completo
  ANULADO /// Anulado
}

/// Tipo de movimiento de saldo con transporte
enum MovimientoTransporte {
  A_FAVOR /// Transportista nos debe
  DEBE /// Debemos al transportista
}

/// Tipos de cuenta bancaria
enum TipoCuenta {
  AHORROS
  CORRIENTE
}

/// Monedas soportadas
enum Moneda {
  SOLES /// Soles peruanos (PEN)
  DOLARES /// D√≥lares americanos (USD)
}

/// Tipo de propietario de cuenta bancaria
enum CuentaBancariaTipo {
  CLIENTE
  PROVEEDOR
  TRANSPORTE
  EMPRESA
}

/// Tipos de cobranza
enum TipoCobranza {
  ESPECIAL /// Cobranza con condiciones especiales
  NORMAL /// Cobranza est√°ndar
}

/// Estados de pago
enum EstadoPago {
  PAGADO /// Pago completado
  URGENTE /// Pago urgente requerido
  PENDIENTE /// Pago pendiente
  PAGO_ENVIADO_VERIFICADO /// Pago enviado y verificado
}

/// Tipos de programaci√≥n de entrega
enum TipoProgramacionOp {
  NORMAL /// Entrega est√°ndar
  URGENTE /// Entrega urgente
  ESPECIAL /// Entrega con condiciones especiales
}

/// Estados de cobranza para ventas al Estado (escalamiento)
/// Flujo: REQ ‚Üí REIT1 ‚Üí REIT2 ‚Üí OCI ‚Üí PC ‚Üí MAXIMA_AUTORIDAD ‚Üí CARTA_NOTARIAL ‚Üí DENUNCIA_JUDICIAL
enum EstadoCobranza {
  REQ /// Requerimiento inicial
  REIT1 /// Primer reiterativo
  REIT2 /// Segundo reiterativo
  OCI /// √ìrgano de Control Institucional
  PC /// Procuradur√≠a
  MAXIMA_AUTORIDAD /// Escalado a m√°xima autoridad
  CARTA_NOTARIAL /// Carta notarial enviada
  DENUNCIA_JUDICIAL /// Proceso judicial iniciado
}

/// Estados de programaci√≥n de entrega
enum EstadoProgramacionOp {
  PENDIENTE /// Programaci√≥n pendiente
  EN_PROCESO /// Entrega en proceso
  COMPLETADA /// Entrega completada
  CANCELADA /// Programaci√≥n cancelada
}
