generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Cliente {
  id                    Int              @id @default(autoincrement())
  razonSocial           String           @map("razon_social")
  ruc                   String           @unique
  direccion             String?
  telefono              String?
  email                 String?
  estado                Boolean          @default(true)
  codigoUnidadEjecutora String?          @map("codigo_unidad_ejecutora")
  departamento          String?
  provincia             String?
  distrito              String?
  createdAt             DateTime         @default(now()) @map("created_at")
  updatedAt             DateTime         @updatedAt @map("updated_at")
  contactos             Contacto[]
  cotizaciones          Cotizacion[]
  cuentasBancarias      CuentaBancaria[]
  ordenesCompra         OrdenCompra[]

  @@map("clientes")
}

model Proveedor {
  id               Int              @id @default(autoincrement())
  razonSocial      String           @map("razon_social")
  ruc              String           @unique
  direccion        String?
  telefono         String?
  email            String?
  estado           Boolean          @default(true)
  departamento     String?
  provincia        String?
  distrito         String?
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  contactos        Contacto[]
  cuentasBancarias CuentaBancaria[]
  ordenesProveedor OrdenProveedor[]
  saldosProveedor  SaldoProveedor[]

  @@map("proveedores")
}

model SaldoProveedor {
  id             Int                 @id @default(autoincrement())
  proveedorId    Int
  tipoMovimiento MovimientoProveedor @default(A_FAVOR)
  monto          Decimal
  descripcion    String?
  banco          String?
  fecha          DateTime            @default(now())
  activo         Boolean             @default(true)
  createdAt      DateTime            @default(now()) @map("created_at")
  updatedAt      DateTime            @updatedAt @map("updated_at")
  proveedor      Proveedor           @relation(fields: [proveedorId], references: [id])

  @@map("saldos_proveedor")
}

model SaldoTransporte {
  id             Int                  @id @default(autoincrement())
  transporteId   Int
  tipoMovimiento MovimientoTransporte @default(A_FAVOR)
  monto          Decimal
  descripcion    String?
  banco          String?
  fecha          DateTime             @default(now())
  activo         Boolean              @default(true)
  createdAt      DateTime             @default(now()) @map("created_at")
  updatedAt      DateTime             @updatedAt @map("updated_at")
  transporte     Transporte           @relation(fields: [transporteId], references: [id])

  @@map("saldos_transporte")
}

model CuentaBancaria {
  id           Int                @id @default(autoincrement())
  referenciaId Int                @map("referencia_id")
  tipoCuenta   CuentaBancariaTipo @map("tipo_cuenta")
  banco        String
  numeroCuenta String
  numeroCci    String?
  moneda       Moneda
  activa       Boolean            @default(true)
  clienteId    Int?               @map("cliente_id")
  proveedorId  Int?               @map("proveedor_id")
  transporteId Int?               @map("transporte_id")
  empresaId    Int?               @map("empresa_id")
  createdAt    DateTime           @default(now()) @map("created_at")
  updatedAt    DateTime           @updatedAt @map("updated_at")
  cliente      Cliente?           @relation(fields: [clienteId], references: [id])
  empresa      Empresa?           @relation(fields: [empresaId], references: [id])
  proveedor    Proveedor?         @relation(fields: [proveedorId], references: [id])
  transporte   Transporte?        @relation(fields: [transporteId], references: [id])

  @@map("cuentas_bancarias")
}

model Transporte {
  id                   Int                  @id @default(autoincrement())
  razonSocial          String               @map("razon_social")
  ruc                  String               @unique
  direccion            String?
  telefono             String?
  email                String?
  estado               Boolean              @default(true)
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  cobertura            String?
  departamento         String?
  distrito             String?
  provincia            String?
  contactos            Contacto[]
  cuentasBancarias     CuentaBancaria[]
  transportesAsignados TransporteAsignado[]
  saldosTransporte     SaldoTransporte[]

  @@map("transportes")
}

model Empresa {
  id               Int              @id @default(autoincrement())
  razonSocial      String           @map("razon_social")
  ruc              String           @unique
  direccion        String?
  telefono         String?
  email            String?
  departamento     String?
  provincia        String?
  distrito         String?
  logo             String?
  direcciones      String?
  web              String?
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  catalogos        Catalogo[]
  cotizaciones     Cotizacion[]
  cuentasBancarias CuentaBancaria[]
  ordenesCompra    OrdenCompra[]
  ordenesProveedor OrdenProveedor[]

  @@map("empresas")
}

model Contacto {
  id                   Int                  @id @default(autoincrement())
  nombre               String
  telefono             String?
  email                String?
  tipo                 ContactoTipo
  referenciaId         Int                  @map("referencia_id")
  clienteId            Int?                 @map("cliente_id")
  proveedorId          Int?                 @map("proveedor_id")
  transporteId         Int?                 @map("transporte_id")
  cargo                String?
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  cumpleanos           DateTime?
  nota                 String?
  usuarioDestacado     Boolean?             @map("usuario_destacado")
  cliente              Cliente?             @relation(fields: [clienteId], references: [id])
  proveedor            Proveedor?           @relation(fields: [proveedorId], references: [id])
  transporte           Transporte?          @relation(fields: [transporteId], references: [id])
  Cotizacion           Cotizacion[]
  ordenesCompra        OrdenCompra[]
  ordenesProveedor     OrdenProveedor[]
  transportesAsignados TransporteAsignado[]

  @@map("contactos")
}

model Catalogo {
  id            Int           @id @default(autoincrement())
  nombre        String
  descripcion   String?
  empresaId     Int           @map("empresa_id")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  empresa       Empresa       @relation(fields: [empresaId], references: [id])
  ordenesCompra OrdenCompra[]

  @@map("catalogos")
}

model Cotizacion {
  id                  Int                  @id @default(autoincrement())
  codigoCotizacion    String               @unique @map("codigo_cotizacion")
  empresaId           Int                  @map("empresa_id")
  clienteId           Int                  @map("cliente_id")
  contactoClienteId   Int?                 @map("contacto_cliente_id")
  montoTotal          Decimal              @map("monto_total")
  tipoPago            TipoPago             @map("tipo_pago")
  notaPago            String?              @map("nota_pago")
  notaPedido          String?              @map("nota_pedido")
  direccionEntrega    String?              @map("direccion_entrega")
  distritoEntrega     String?              @map("distrito_entrega")
  provinciaEntrega    String?              @map("provincia_entrega")
  departamentoEntrega String?              @map("departamento_entrega")
  referenciaEntrega   String?              @map("referencia_entrega")
  estado              CotizacionEstado     @default(PENDIENTE)
  fechaCotizacion     DateTime             @map("fecha_cotizacion")
  fechaEntrega        DateTime?            @map("fecha_entrega")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  productos           CotizacionProducto[]
  cliente             Cliente              @relation(fields: [clienteId], references: [id])
  contactoCliente     Contacto?            @relation(fields: [contactoClienteId], references: [id])
  empresa             Empresa              @relation(fields: [empresaId], references: [id])

  @@map("cotizaciones")
}

model CotizacionProducto {
  id              Int        @id @default(autoincrement())
  codigo          String
  descripcion     String
  unidadMedida    String?    @map("unidad_medida")
  cantidad        Int
  cantidadAlmacen Int?       @map("cantidad_almacen")
  cantidadCliente Int?       @map("cantidad_cliente")
  cantidadTotal   Int        @map("cantidad_total")
  precioUnitario  Decimal    @map("precio_unitario")
  total           Decimal
  cotizacionId    Int        @map("cotizacion_id")
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")
  cotizacion      Cotizacion @relation(fields: [cotizacionId], references: [id])

  @@map("cotizacion_productos")
}

model OrdenCompra {
  id                    Int                   @id @default(autoincrement())
  codigoVenta           String                @unique @map("codigo_venta")
  fechaEmision          DateTime?             @map("fecha_emision") @db.Date
  archivoOc             String?               @map("archivo_oc")
  empresaId             Int?                  @map("empresa_id")
  clienteId             Int?                  @map("cliente_id")
  contactoClienteId     Int?                  @map("contacto_cliente_id")
  catalogoEmpresaId     Int?                  @map("catalogo_empresa_id")
  ventaPrivada          Boolean               @default(false) @map("venta_privada")
  provinciaEntrega      String?               @map("provincia_entrega")
  distritoEntrega       String?               @map("distrito_entrega")
  departamentoEntrega   String?               @map("departamento_entrega")
  direccionEntrega      String?               @map("direccion_entrega")
  referenciaEntrega     String?               @map("referencia_entrega")
  fechaEntrega          DateTime?             @map("fecha_entrega") @db.Date
  montoVenta            Decimal?              @map("monto_venta") @db.Decimal(10, 2)
  fechaForm             DateTime?             @map("fecha_form") @db.Date
  fechaMaxForm          DateTime?             @map("fecha_max_form") @db.Date
  productos             Json?
  documentoOce          String?               @map("documento_oce")
  documentoOcf          String?               @map("documento_ocf")
  codigoOcf             String?               @map("codigo_ocf") // Código manual de orden de compra física
  siaf                  String?
  etapaSiaf             String?               @map("etapa_siaf")
  fechaSiaf             DateTime?             @map("fecha_siaf") @db.Date
  documentoPeruCompras  String?               @map("documento_peru_compras")
  fechaPeruCompras      DateTime?             @map("fecha_peru_compras") @db.Date
  fechaEntregaOc        DateTime?             @map("fecha_entrega_oc") @db.Date
  penalidad             Decimal?              @db.Decimal(10, 2)
  netoCobrado           Decimal?              @map("neto_cobrado") @db.Decimal(10, 2)
  estadoCobranza        EstadoCobranza?       @map("estado_cobranza")
  fechaEstadoCobranza   DateTime?             @map("fecha_estado_cobranza") @db.Date
  fechaProximaGestion   DateTime?             @map("fecha_proxima_gestion") @db.Date
  etapaActual           String                @default("creacion") @map("etapa_actual")
  estadoVenta           String                @default("incompleto") @map("estado_venta")
  estadoActivo          Boolean               @default(true) @map("estado_activo")
  createdAt             DateTime              @default(now()) @map("created_at")
  updatedAt             DateTime              @updatedAt @map("updated_at")
  facturaciones         Facturacion[]
  gestionCobranzas      GestionCobranza[]
  catalogoEmpresa       Catalogo?             @relation(fields: [catalogoEmpresaId], references: [id])
  cliente               Cliente?              @relation(fields: [clienteId], references: [id])
  contactoCliente       Contacto?             @relation(fields: [contactoClienteId], references: [id])
  empresa               Empresa?              @relation(fields: [empresaId], references: [id])
  OrdenCompraAgrupada   OrdenCompraAgrupada[]
  ordenCompraPrivada    OrdenCompraPrivada?
  ordenesProveedor      OrdenProveedor[]
  programacionesEntrega ProgramacionEntrega[]

  @@map("ordenes_compra")
}

model AgrupacionOrdenCompra {
  id            Int                   @id @default(autoincrement())
  codigoGrupo   String                @unique @map("codigo_grupo") @db.VarChar(255)
  descripcion   String?
  fecha         DateTime              @default(now())
  createdAt     DateTime              @default(now()) @map("created_at")
  updatedAt     DateTime              @updatedAt @map("updated_at")
  ordenesCompra OrdenCompraAgrupada[]

  @@map("agrupaciones_orden_compra")
}

model OrdenCompraAgrupada {
  id                      Int                   @id @default(autoincrement())
  agrupacionOrdenCompraId Int                   @map("agrupacion_orden_compra_id")
  ordenCompraId           Int                   @map("orden_compra_id")
  createdAt               DateTime              @default(now()) @map("created_at")
  updatedAt               DateTime              @updatedAt @map("updated_at")
  agrupacion              AgrupacionOrdenCompra @relation(fields: [agrupacionOrdenCompraId], references: [id])
  ordenCompra             OrdenCompra           @relation(fields: [ordenCompraId], references: [id])

  @@map("ordenes_compra_agrupadas")
}

model OrdenCompraPrivada {
  id                  Int         @id @default(autoincrement())
  ordenCompraId       Int         @unique @map("orden_compra_id") // Clave foránea y única para relación 1-1
  estadoPago          EstadoPago? @map("estado_pago")
  fechaPago           DateTime?   @map("fecha_pago") @db.Date
  documentoPago       String?     @map("documento_pago")
  documentoCotizacion String?     @map("documento_cotizacion") // Documento de cotización
  cotizacion          String?     @map("cotizacion") // Campo de cotización como texto
  notaPago            String?     @map("nota_pago")

  // Campos de tipo de entrega
  tipoDestino   TipoEntregaPrivada? @map("tipo_destino")
  nombreAgencia String?             @map("nombre_agencia")
  destinoFinal  String?             @map("destino_final")
  nombreEntidad String?             @map("nombre_entidad")

  createdAt        DateTime                 @default(now()) @map("created_at")
  updatedAt        DateTime                 @updatedAt @map("updated_at")
  // Relaciones
  ordenCompra      OrdenCompra              @relation(fields: [ordenCompraId], references: [id])
  pagos            PagoOrdenCompraPrivada[] // Relación inversa
  gestionCobranzas GestionCobranza[] // Relación inversa añadida

  @@map("ordenes_compra_privadas")
}

model PagoOrdenCompraPrivada {
  id                   Int                @id @default(autoincrement())
  ordenCompraPrivadaId Int                @map("orden_compra_privada_id")
  fechaPago            DateTime?          @map("fecha_pago") @db.Date
  bancoPago            String?            @map("banco_pago")
  descripcionPago      String?            @map("descripcion_pago")
  archivoPago          String?            @map("archivo_pago")
  montoPago            Decimal?           @map("monto_pago") @db.Decimal(10, 2)
  estadoPago           Boolean            @default(false) @map("estado_pago")
  createdAt            DateTime           @default(now()) @map("created_at")
  updatedAt            DateTime           @updatedAt @map("updated_at")
  ordenCompraPrivada   OrdenCompraPrivada @relation(fields: [ordenCompraPrivadaId], references: [id])

  @@map("pagos_ordenes_compra_privadas")
}

model OrdenProveedor {
  id                      Int                         @id @default(autoincrement())
  codigoOp                String                      @map("codigo_op") @db.VarChar(255)
  empresaId               Int?                        @map("empresa_id")
  proveedorId             Int?                        @map("proveedor_id")
  contactoProveedorId     Int?                        @map("contacto_proveedor_id")
  fechaDespacho           DateTime?                   @map("fecha_despacho")
  fechaProgramada         DateTime?                   @map("fecha_programada")
  fechaRecepcion          DateTime?                   @map("fecha_recepcion")
  notaPedido              String?                     @map("nota_pedido")
  totalProveedor          Decimal?                    @map("total_proveedor")
  tipoPago                String?                     @map("tipo_pago")
  notaPago                String?                     @map("nota_pago")
  notaGestionOp           String?                     @map("nota_gestion_op")
  tipoEntrega             String?                     @map("tipo_entrega")
  retornoMercaderia       String?                     @map("retorno_mercaderia")
  estadoOp                String?                     @map("estado_op")
  fechaEntrega            String?                     @map("fecha_entrega")
  cargoOea                String?                     @map("cargo_oea")
  etiquetado              String?
  embalaje                String?
  observaciones           String?
  notaAdicional           String?                     @map("nota_adicional")
  activo                  Boolean                     @default(true)
  ordenCompraId           Int?                        @map("orden_compra_id")
  createdAt               DateTime?                   @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt               DateTime?                   @updatedAt @map("updated_at") @db.Timestamp(6)
  contactoProveedor       Contacto?                   @relation(fields: [contactoProveedorId], references: [id])
  empresa                 Empresa?                    @relation(fields: [empresaId], references: [id])
  ordenCompra             OrdenCompra?                @relation(fields: [ordenCompraId], references: [id])
  proveedor               Proveedor?                  @relation(fields: [proveedorId], references: [id])
  pagos                   PagoOrdenProveedor[]
  productos               OpProducto[]
  transportesAsignados    TransporteAsignado[]
  historialModificaciones HistorialModificacionesOp[]
  programacionesEntrega   ProgramacionEntrega[]
  costosAdicionales       CostoAdicionalOp[]

  @@map("ordenes_proveedor")
}

model OpProducto {
  id               Int            @id @default(autoincrement())
  codigo           String
  descripcion      String
  unidadMedida     String?        @map("unidad_medida")
  cantidad         Int
  cantidadAlmacen  Int?           @map("cantidad_almacen")
  cantidadCliente  Int?           @map("cantidad_cliente")
  cantidadTotal    Int            @map("cantidad_total")
  precioUnitario   Decimal        @map("precio_unitario")
  total            Decimal
  ordenProveedorId Int            @map("orden_proveedor_id")
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  ordenProveedor   OrdenProveedor @relation(fields: [ordenProveedorId], references: [id])

  @@map("productos_orden_proveedor")
}

model TransporteAsignado {
  id                   Int                      @id @default(autoincrement())
  codigoTransporte     String                   @map("codigo_transporte")
  transporteId         Int                      @map("transporte_id")
  ordenProveedorId     Int                      @map("orden_proveedor_id")
  contactoTransporteId Int?                     @map("contacto_transporte_id")
  almacenId            Int?                     @map("almacen_id")
  region               String?
  provincia            String?
  distrito             String?
  direccion            String?
  notaTransporte       String?                  @map("nota_transporte")
  cotizacionTransporte String?                  @map("cotizacion_transporte")
  estadoPago           EstadoPago?              @map("estado_pago")
  montoFlete           Decimal?                 @map("monto_flete") @db.Decimal(10, 2)
  notaPago             String?                  @map("nota_pago")
  grt                  String?
  createdAt            DateTime                 @default(now()) @map("created_at")
  updatedAt            DateTime                 @updatedAt @map("updated_at")
  tipoDestino          TipoDestino              @map("tipo_destino")
  pagos                PagoTransporteAsignado[]
  contactoTransporte   Contacto?                @relation(fields: [contactoTransporteId], references: [id])
  ordenProveedor       OrdenProveedor           @relation(fields: [ordenProveedorId], references: [id])
  transporte           Transporte               @relation(fields: [transporteId], references: [id])
  almacen              Almacen?                 @relation(fields: [almacenId], references: [id])

  @@map("transportes_asignados")
}

model PagoTransporteAsignado {
  id                   Int                @id @default(autoincrement())
  transporteAsignadoId Int                @map("transporte_asignado_id")
  fechaPago            DateTime?          @map("fecha_pago") @db.Date
  bancoPago            String?            @map("banco_pago")
  descripcionPago      String?            @map("descripcion_pago")
  archivoPago          String?            @map("archivo_pago")
  montoPago            Decimal?           @map("monto_pago") @db.Decimal(10, 2)
  estadoPago           Boolean?           @default(false) @map("estado_pago")
  activo               Boolean?           @default(true)
  createdAt            DateTime           @default(now()) @map("created_at")
  updatedAt            DateTime           @updatedAt @map("updated_at")
  transporteAsignado   TransporteAsignado @relation(fields: [transporteAsignadoId], references: [id])

  @@map("pagos_transportes_asignados")
}

model PagoOrdenProveedor {
  id               Int             @id @default(autoincrement())
  fechaPago        DateTime?       @map("fecha_pago")
  bancoPago        String?         @map("banco_pago") @db.VarChar(255)
  descripcionPago  String?         @map("descripcion_pago")
  archivoPago      String?         @map("archivo_pago") @db.VarChar(255)
  montoPago        Decimal?        @map("monto_pago") @db.Decimal(10, 4)
  estadoPago       Boolean         @default(false) @map("estado_pago")
  activo           Boolean         @default(true)
  ordenProveedorId Int?            @map("orden_proveedor_id")
  createdAt        DateTime?       @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt        DateTime?       @updatedAt @map("updated_at") @db.Timestamp(6)
  ordenProveedor   OrdenProveedor? @relation(fields: [ordenProveedorId], references: [id])

  @@map("pagos_orden_proveedor")
}

model Producto {
  id             Int             @id @default(autoincrement())
  nombre         String
  descripcion    String?
  unidadMedida   String?         @map("unidad_medida")
  precioBase     Decimal?        @map("precio_base") @db.Decimal(10, 4)
  estado         Boolean?        @default(true)
  createdAt      DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime        @updatedAt @map("updated_at")
  stockProductos StockProducto[]

  @@map("productos")
}

model StockProducto {
  id         Int      @id @default(autoincrement())
  productoId Int      @map("producto_id")
  almacenId  Int      @map("almacen_id")
  cantidad   Int      @default(0)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  almacen    Almacen  @relation(fields: [almacenId], references: [id])
  producto   Producto @relation(fields: [productoId], references: [id])

  @@unique([productoId, almacenId])
  @@map("stock_productos")
}

model Almacen {
  id                   Int                  @id @default(autoincrement())
  nombre               String
  direccion            String?
  ciudad               String?
  createdAt            DateTime             @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime             @updatedAt @map("updated_at")
  stockProductos       StockProducto[]
  transportesAsignados TransporteAsignado[]

  @@map("almacenes")
}

model Facturacion {
  id                Int         @id @default(autoincrement())
  ordenCompraId     Int         @map("orden_compra_id")
  factura           String?
  fechaFactura      DateTime?   @map("fecha_factura") @db.Date
  grr               String?
  retencion         Decimal?    @db.Decimal(10, 2)
  detraccion        Decimal?    @db.Decimal(10, 2)
  formaEnvioFactura String?     @map("forma_envio_factura")
  estado            Int?        @default(1)
  createdAt         DateTime    @default(now()) @map("created_at")
  updatedAt         DateTime    @updatedAt @map("updated_at")
  ordenCompra       OrdenCompra @relation(fields: [ordenCompraId], references: [id])

  @@map("facturaciones")
}

model GestionCobranza {
  id                   Int             @id @default(autoincrement())
  ordenCompraId        Int?            @map("orden_compra_id")
  ordenCompraPrivadaId Int?            @map("orden_compra_privada_id")
  usuarioId            Int             @map("usuario_id")
  fechaGestion         DateTime        @map("fecha_gestion")
  notaGestion          String?         @map("nota_gestion")
  estadoCobranza       EstadoCobranza? @map("estado_cobranza")

  tipoCobranza                 TipoCobranza? @map("tipo_cobranza")
  voucherPagoUrl               String?       @map("voucher_pago_url")
  pagoConformeTesoreria        Boolean?      @default(false) @map("pago_conforme_tesoreria")
  cartaAmpliacionUrl           String?       @map("carta_ampliacion_url")
  capturaEnvioDocumentoUrl     String?       @map("captura_envio_documento_url")
  archivosAdjuntosNotasGestion String[]      @map("archivos_adjuntos_notas_gestion")
  documentosRegistrados        String[]      @map("documentos_registrados")
  notaEspecialEntrega          String?       @map("nota_especial_entrega")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  ordenCompra        OrdenCompra?        @relation(fields: [ordenCompraId], references: [id])
  ordenCompraPrivada OrdenCompraPrivada? @relation(fields: [ordenCompraPrivadaId], references: [id])
  usuario            Usuario             @relation(fields: [usuarioId], references: [id])

  @@map("gestion_cobranzas")
}

model Usuario {
  id           Int      @id @default(autoincrement())
  nombre       String
  email        String   @unique
  password     String
  role         Role     @default(USER)
  foto         String?
  estado       Boolean  @default(true)
  telefono     String?
  departamento String?
  ubicacion    String?
  permisos     String[] @default([])
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  gestionCobranzas        GestionCobranza[]
  historialModificaciones HistorialModificacionesOp[]
  programacionesEntrega   ProgramacionEntrega[]       @relation("ResponsableProgramacion")

  @@map("usuarios")
}

enum TipoDestino {
  ALMACEN
  CLIENTE
  AGENCIA
}

enum TipoEntregaPrivada {
  ENTREGA_DOMICILIO
  ENTREGA_AGENCIA
  RECOJO_ALMACEN
}

enum ContactoTipo {
  CLIENTE
  PROVEEDOR
  TRANSPORTE
}

enum CotizacionEstado {
  PENDIENTE
  APROBADO
  COTIZADO
}

enum OrdenCompraEstado {
  PENDIENTE
  FACTURADA
  CANCELADA
}

enum OrdenProveedorEstado {
  PENDIENTE
  RECIBIDA
  ANULADA
}

enum Role {
  ADMIN
  USER
}

enum TipoPago {
  CONTADO
  CREDITO
  ANTICIPADO
  OTROS
}

enum MovimientoProveedor {
  A_FAVOR
  DEBE
}

enum MovimientoTransporte {
  A_FAVOR
  DEBE
}

enum TipoCuenta {
  AHORROS
  CORRIENTE
}

enum Moneda {
  SOLES
  DOLARES
}

enum CuentaBancariaTipo {
  CLIENTE
  PROVEEDOR
  TRANSPORTE
  EMPRESA
}

enum TipoCobranza {
  ESPECIAL
  NORMAL
}

// Estados de pago para tesorería
enum EstadoPago {
  PAGADO
  URGENTE
  PENDIENTE
}

// Tipos de programación de entrega
enum TipoProgramacionOp {
  NORMAL
  URGENTE
  ESPECIAL
}

// Estados de programación de entrega
enum EstadoCobranza {
  REQ
  REIT1
  REIT2
  OCI
  PC
  MAXIMA_AUTORIDAD
  CARTA_NOTARIAL
  DENUNCIA_JUDICIAL
}

enum EstadoProgramacionOp {
  PENDIENTE
  EN_PROCESO
  COMPLETADA
  CANCELADA
}

model HistorialModificacionesOp {
  id                Int      @id @default(autoincrement())
  ordenProveedorId  Int      @map("orden_proveedor_id")
  usuarioId         Int      @map("usuario_id")
  campoModificado   String   @map("campo_modificado")
  valorAnterior     String?  @map("valor_anterior")
  valorNuevo        String?  @map("valor_nuevo")
  fechaModificacion DateTime @default(now()) @map("fecha_modificacion")
  motivo            String?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  ordenProveedor OrdenProveedor @relation(fields: [ordenProveedorId], references: [id])
  usuario        Usuario        @relation(fields: [usuarioId], references: [id])

  @@map("historial_modificaciones_op")
}

model ProgramacionEntrega {
  id                   Int                  @id @default(autoincrement())
  ordenProveedorId     Int?                 @map("orden_proveedor_id")
  ordenCompraId        Int?                 @map("orden_compra_id")
  tipoProgramacion     TipoProgramacionOp   @map("tipo_programacion")
  estadoProgramacion   EstadoProgramacionOp @map("estado_programacion")
  responsableEntregaId Int?                 @map("responsable_entrega_id")
  fechaMaximaEntrega   DateTime?            @map("fecha_maxima_entrega")
  monto                Decimal?
  ordenElectronica     String?              @map("orden_electronica_prog")
  ordenFisica          String?              @map("orden_fisica_prog")
  departamentoEntrega  String?              @map("departamento_entrega_prog")
  provinciaEntrega     String?              @map("provincia_entrega_prog")
  distritoEntrega      String?              @map("distrito_entrega_prog")
  documentosAdjuntos   String[]             @map("documentos_adjuntos_prog")
  nota                 String?              @map("nota_prog")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  ordenProveedor     OrdenProveedor? @relation(fields: [ordenProveedorId], references: [id])
  ordenCompra        OrdenCompra?    @relation(fields: [ordenCompraId], references: [id])
  responsableEntrega Usuario?        @relation("ResponsableProgramacion", fields: [responsableEntregaId], references: [id])

  @@map("programaciones_entrega")
}

model CostoAdicionalOp {
  id               Int     @id @default(autoincrement())
  ordenProveedorId Int     @map("orden_proveedor_id")
  concepto         String
  descripcion      String?
  comprobanteUrl   String? @map("comprobante_url")
  monto            Decimal

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  ordenProveedor OrdenProveedor @relation(fields: [ordenProveedorId], references: [id])

  @@map("costos_adicionales_op")
}
